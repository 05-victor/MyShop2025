### Debug JWT Token Claims
### Base URL Configuration
@host = http://localhost:5228
@token = 

### ============================================
### Step 1: Register a test user (if not exists)
### ============================================
POST {{host}}/api/v1/auth/register
Content-Type: application/json

{
  "username": "debuguser",
  "email": "debug@example.com",
  "password": "password123",
  "sdt": "0123456789",
  "activateTrial": true,
  "roleNames": ["User"]
}

###

### ============================================
### Step 2: Login to get JWT token
### Copy the token from response and paste to @token above
### ============================================
POST {{host}}/api/v1/auth/login
Content-Type: application/json

{
  "usernameOrEmail": "debuguser",
  "password": "password123"
}

###

### ============================================
### Step 3: Test Get Me with token
### Check the server logs to see all claims
### ============================================
GET {{host}}/api/v1/auth/me
Authorization: Bearer {{token}}

###

### ============================================
### Expected Logs in Console:
### ============================================
# info: Program[0]
#       ? Token validated for user: debuguser
# info: Program[0]
#       ?? Token claims:
# info: Program[0]
#         - http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: <GUID>
# info: Program[0]
#         - http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: debuguser
# info: Program[0]
#         - http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: debug@example.com
# 
# info: MyShop.Server.Services.Implementations.AuthService[0]
#       ?? All claims in token:
# info: MyShop.Server.Services.Implementations.AuthService[0]
#         - http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: <GUID>
# 
# info: MyShop.Server.Services.Implementations.AuthService[0]
#       ? GetMe called from JWT token for userId: <GUID>

### ============================================
### If you see "User ID not found" error:
### ============================================
# 1. Check logs to see what claim types are in the token
# 2. The claim type might be:
#    - "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"
#    - "sub"
#    - "nameid"
# 3. InfoJwtService.GetUserId() will try all three

### ============================================
### Troubleshooting Steps:
### ============================================
# 1. Make sure token is not expired (5 minutes default)
# 2. Check server logs for claim types
# 3. Verify MapInboundClaims setting in Program.cs
# 4. Make sure Authorization header format is: "Bearer <token>"
# 5. Token should NOT have extra spaces or quotes