<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="MyShop.Client.Views.Admin.AdminProductsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:badges="using:MyShop.Client.Views.Components.Badges"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:MyShop.Client.Views.Admin"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:pagination="using:MyShop.Client.Views.Components.Pagination"
    xmlns:viewmodels="using:MyShop.Client.ViewModels.Product"
    x:Name="MyPage"
    Background="#F3F4F6"
    mc:Ignorable="d">

    <Page.Resources>

        <!--  Card style (giống card trắng bo góc trong React)  -->
        <Style x:Key="CardBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="White" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="BorderBrush" Value="#E5E7EB" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="Margin" Value="0,0,0,16" />
        </Style>

        <!--  Badge stock  -->
        <Style x:Key="StockBadgeStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="999" />
            <Setter Property="Padding" Value="4,2" />
            <Setter Property="HorizontalAlignment" Value="Left" />
        </Style>

        <!--  Action icon button nhỏ  -->
        <Style x:Key="IconGhostButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="4" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
        </Style>

    </Page.Resources>

    <Grid>
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Padding="32" Spacing="24">

                <!--  PAGE TITLE  -->
                <TextBlock
                    Style="{StaticResource DisplayHeadingStyle}"
                    Foreground="#111827"
                    Text="Products Management" />

                <!--  HEADER ACTIONS  -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!--  Left: Add / Export / Import  -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <!--  Add Product  -->
                        <Button
                            x:Name="AddProductButton"
                            Padding="12,8"
                            Background="#2563EB"
                            BorderThickness="0"
                            Click="AddProductButton_Click"
                            CornerRadius="8"
                            Foreground="White">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon
                                    Width="24"
                                    Height="24"
                                    Glyph="&#xE710;" />
                                <!--  Plus  -->
                                <TextBlock Text="Add Product" />
                            </StackPanel>
                        </Button>

                        <!--  Export  -->
                        <Button
                            Margin="0,0,4,0"
                            Padding="12,8"
                            Background="White"
                            BorderBrush="#E5E7EB"
                            BorderThickness="1"
                            Click="ExportButton_Click"
                            CornerRadius="8"
                            Foreground="#111827">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon
                                    Width="24"
                                    Height="24"
                                    Glyph="&#xE898;" />
                                <!--  Upload-ish  -->
                                <TextBlock Text="Export" />
                            </StackPanel>
                        </Button>

                        <!--  Import  -->
                        <Button
                            Padding="12,8"
                            Background="White"
                            BorderBrush="#E5E7EB"
                            BorderThickness="1"
                            Click="ImportButton_Click"
                            CornerRadius="8"
                            Foreground="#111827">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon
                                    Width="24"
                                    Height="24"
                                    Glyph="&#xE898;"
                                    RenderTransformOrigin="0.5,0.5">
                                    <FontIcon.RenderTransform>
                                        <RotateTransform Angle="180" />
                                    </FontIcon.RenderTransform>
                                </FontIcon>
                                <TextBlock Text="Import" />
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!--  Right: Refresh  -->
                    <Button
                        Grid.Column="1"
                        Padding="12,8"
                        Background="White"
                        BorderBrush="#E5E7EB"
                        BorderThickness="1"
                        Command="{x:Bind ViewModel.RefreshCommand}"
                        CornerRadius="8"
                        Foreground="#111827">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon
                                Width="24"
                                Height="24"
                                Glyph="&#xE72C;" />
                            <!--  Refresh  -->
                            <TextBlock Text="Refresh" />
                        </StackPanel>
                    </Button>
                </Grid>

                <!--  FILTERS CARD  -->
                <Border Style="{StaticResource CardBorderStyle}">
                    <StackPanel Spacing="16">
                        <TextBlock
                            FontSize="16"
                            FontWeight="SemiBold"
                            Foreground="#111827"
                            Text="Filters" />

                        <Grid HorizontalAlignment="Stretch" ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="3*" />
                                <!--  Search  -->
                                <ColumnDefinition Width="2*" />
                                <!--  Category  -->
                                <ColumnDefinition Width="2*" />
                                <!--  Min price  -->
                                <ColumnDefinition Width="2*" />
                                <!--  Max price  -->
                                <ColumnDefinition Width="2*" />
                                <!--  Sort  -->
                            </Grid.ColumnDefinitions>

                            <!--  Search  -->
                            <StackPanel Grid.Column="0">
                                <TextBlock
                                    Margin="0,0,0,4"
                                    FontSize="12"
                                    Foreground="#6B7280"
                                    Text="Search" />
                                <TextBox
                                    x:Name="SearchTextBox"
                                    BorderBrush="#E5E7EB"
                                    BorderThickness="1"
                                    PlaceholderText="Search by name..." />
                            </StackPanel>

                            <!--  Category  -->
                            <StackPanel Grid.Column="1">
                                <TextBlock
                                    Margin="0,0,0,4"
                                    FontSize="12"
                                    Foreground="#6B7280"
                                    Text="Category" />
                                <ComboBox
                                    x:Name="CategoryComboBox"
                                    HorizontalAlignment="Stretch"
                                    BorderBrush="#E5E7EB"
                                    BorderThickness="1"
                                    PlaceholderText="All Categories">
                                    <!--  sau này binding ItemsSource Categories  -->
                                    <ComboBoxItem Content="All Categories" />
                                    <ComboBoxItem Content="Smartphones" />
                                    <ComboBoxItem Content="Laptops" />
                                    <ComboBoxItem Content="Audio" />
                                    <ComboBoxItem Content="Tablets" />
                                    <ComboBoxItem Content="Wearables" />
                                </ComboBox>
                            </StackPanel>

                            <!--  Min Price  -->
                            <StackPanel Grid.Column="2">
                                <TextBlock
                                    Margin="0,0,0,4"
                                    FontSize="12"
                                    Foreground="#6B7280"
                                    Text="Min Price" />
                                <TextBox
                                    x:Name="MinPriceTextBox"
                                    BorderBrush="#E5E7EB"
                                    BorderThickness="1"
                                    InputScope="Number"
                                    PlaceholderText="0" />
                            </StackPanel>

                            <!--  Max Price  -->
                            <StackPanel Grid.Column="3">
                                <TextBlock
                                    Margin="0,0,0,4"
                                    FontSize="12"
                                    Foreground="#6B7280"
                                    Text="Max Price" />
                                <TextBox
                                    x:Name="MaxPriceTextBox"
                                    BorderBrush="#E5E7EB"
                                    BorderThickness="1"
                                    InputScope="Number"
                                    PlaceholderText="∞" />
                            </StackPanel>

                            <!--  Sort By  -->
                            <StackPanel Grid.Column="4">
                                <TextBlock
                                    Margin="0,0,0,4"
                                    FontSize="12"
                                    Foreground="#6B7280"
                                    Text="Sort By" />
                                <ComboBox
                                    x:Name="SortByComboBox"
                                    BorderBrush="#E5E7EB"
                                    BorderThickness="1"
                                    SelectedIndex="0">
                                    <ComboBoxItem Content="Rating (High to Low)" Tag="rating-desc" />
                                    <ComboBoxItem Content="Price (High to Low)" Tag="price-desc" />
                                    <ComboBoxItem Content="Price (Low to High)" Tag="price-asc" />
                                    <ComboBoxItem Content="Name (A-Z)" Tag="name-asc" />
                                    <ComboBoxItem Content="Name (Z-A)" Tag="name-desc" />
                                </ComboBox>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!--  PRODUCTS TABLE CARD  -->
                <Border Style="{StaticResource CardBorderStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <!--  Table  -->
                        <ListView
                            x:Name="ProductsListView"
                            Grid.Row="0"
                            BorderThickness="0"
                            IsItemClickEnabled="False"
                            ItemsSource="{x:Bind ViewModel.Products, Mode=OneWay}">
                            <ListView.Resources>
                                <!--  để ListView trong suốt, giữ border ngoài  -->
                                <Style TargetType="ListView">
                                    <Setter Property="Background" Value="Transparent" />
                                </Style>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="Padding" Value="12,8" />
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                </Style>
                            </ListView.Resources>

                            <ListView.Header>
                                <!--  Header row  -->
                                <Grid Padding="8,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="1*" />
                                        <!--  Image  -->
                                        <ColumnDefinition Width="3*" />
                                        <!--  Name  -->
                                        <ColumnDefinition Width="2*" />
                                        <!--  Category  -->
                                        <ColumnDefinition Width="1*" />
                                        <!--  Price  -->
                                        <ColumnDefinition Width="2*" />
                                        <!--  Import Price  -->
                                        <ColumnDefinition Width="2*" />
                                        <!--  Stock  -->
                                        <ColumnDefinition Width="1*" />
                                        <!--  Rating  -->
                                        <ColumnDefinition Width="2*" />
                                        <!--  Actions  -->
                                    </Grid.ColumnDefinitions>

                                    <TextBlock
                                        Grid.Column="0"
                                        FontWeight="SemiBold"
                                        Text="Image" />
                                    <TextBlock
                                        Grid.Column="1"
                                        FontWeight="SemiBold"
                                        Text="Product Name" />
                                    <TextBlock
                                        Grid.Column="2"
                                        FontWeight="SemiBold"
                                        Text="Category" />
                                    <TextBlock
                                        Grid.Column="3"
                                        FontWeight="SemiBold"
                                        Text="Price" />
                                    <TextBlock
                                        Grid.Column="4"
                                        FontWeight="SemiBold"
                                        Text="Import Price" />
                                    <TextBlock
                                        Grid.Column="5"
                                        FontWeight="SemiBold"
                                        Text="Stock" />
                                    <TextBlock
                                        Grid.Column="6"
                                        FontWeight="SemiBold"
                                        Text="Rating" />
                                    <TextBlock
                                        Grid.Column="7"
                                        FontWeight="SemiBold"
                                        Text="Actions" />
                                </Grid>
                            </ListView.Header>

                            <!--  1 row  -->
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <!--  Sau này đổi sang x:DataType cho mạnh  -->
                                    <Grid Padding="-8,4,0,4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1*" />
                                            <ColumnDefinition Width="3*" />
                                            <ColumnDefinition Width="2*" />
                                            <ColumnDefinition Width="1*" />
                                            <ColumnDefinition Width="2*" />
                                            <ColumnDefinition Width="2*" />
                                            <ColumnDefinition Width="1*" />
                                            <ColumnDefinition Width="2*" />
                                        </Grid.ColumnDefinitions>

                                        <!--  Image  -->
                                        <Border
                                            Grid.Column="0"
                                            Width="48"
                                            Height="48"
                                            HorizontalAlignment="Left"
                                            Background="#E5E7EB"
                                            CornerRadius="8">
                                            <Rectangle RadiusX="8" RadiusY="8">
                                                <Rectangle.Fill>
                                                    <ImageBrush ImageSource="{Binding Image}" Stretch="UniformToFill" />
                                                </Rectangle.Fill>
                                            </Rectangle>
                                        </Border>

                                        <!--  Product name + SKU  -->
                                        <StackPanel
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            Spacing="2">
                                            <TextBlock Text="{Binding Name}" TextTrimming="CharacterEllipsis" />
                                            <TextBlock
                                                FontSize="12"
                                                Foreground="#6B7280"
                                                Text="{Binding Sku}" />
                                        </StackPanel>

                                        <!--  Category  -->
                                        <TextBlock
                                            Grid.Column="2"
                                            VerticalAlignment="Center"
                                            Text="{Binding Category}" />
                                        <!--  Price  -->
                                        <TextBlock
                                            Grid.Column="3"
                                            VerticalAlignment="Center"
                                            Foreground="#10B981"
                                            Text="{Binding Price}" />

                                        <!--  Import price  -->
                                        <TextBlock
                                            Grid.Column="4"
                                            VerticalAlignment="Center"
                                            Foreground="#6B7280"
                                            Text="{Binding ImportPrice}" />

                                        <!--  Stock badge  -->
                                        <!--<Border Grid.Column="5"
                                                Style="{StaticResource StockBadgeStyle}"
                                                Background="#10B981">
                                        -->
                                        <!--  TODO: sau này dùng converter đổi màu theo Stock  -->
                                        <!--
                                            <TextBlock Text="{Binding Stock}"
                                                       Foreground="White"
                                                       FontSize="12"/>
                                        </Border>-->
                                        <Border
                                            Grid.Column="5"
                                            Margin="0,12"
                                            Padding="8,4"
                                            HorizontalAlignment="Center"
                                            Background="#10B981"
                                            CornerRadius="4">
                                            <TextBlock
                                                VerticalAlignment="Center"
                                                FontSize="12"
                                                Foreground="White"
                                                Text="{Binding Stock}" />
                                        </Border>
                                        <!--  Price  -->
                                        <TextBlock
                                            Grid.Column="3"
                                            VerticalAlignment="Center"
                                            Foreground="#10B981"
                                            Text="{Binding Price}" />

                                        <!--  Import price  -->
                                        <TextBlock
                                            Grid.Column="4"
                                            VerticalAlignment="Center"
                                            Foreground="#6B7280"
                                            Text="{Binding ImportPrice}" />

                                        <!--  Stock badge  -->
                                        <badges:StockBadge
                                            Grid.Column="5"
                                            HorizontalAlignment="Left"
                                            LowStockThreshold="10"
                                            Stock="{Binding Stock}" />

                                        <!--  Rating  -->
                                        <StackPanel
                                            Grid.Column="6"
                                            Orientation="Horizontal"
                                            Spacing="4">
                                            <TextBlock VerticalAlignment="Center" Text="{Binding Rating}" />
                                            <FontIcon
                                                FontSize="14"
                                                Foreground="#F59E0B"
                                                Glyph="&#xE735;" />
                                        </StackPanel>

                                        <!--  Actions  -->
                                        <StackPanel
                                            Grid.Column="7"
                                            Orientation="Horizontal"
                                            Spacing="4">
                                            <!--  Edit  -->
                                            <Button
                                                Command="{Binding DataContext.EditProductCommand, ElementName=MyPage}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource IconGhostButtonStyle}">
                                                <FontIcon Foreground="#2563EB" Glyph="&#xE70F;" />
                                                <!--  Edit icon  -->
                                            </Button>

                                            <!--  Delete  -->
                                            <Button
                                                Command="{Binding DataContext.DeleteProductCommand, ElementName=MyPage}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource IconGhostButtonStyle}">
                                                <FontIcon Foreground="#DC2626" Glyph="&#xE74D;" />
                                                <!--  Trash  -->
                                            </Button>

                                            <!--  View  -->
                                            <Button
                                                Command="{Binding DataContext.ViewProductCommand, ElementName=MyPage}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource IconGhostButtonStyle}">
                                                <FontIcon Foreground="#6B7280" Glyph="&#xE8A7;" />
                                                <!--  View  -->
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <!--  Sau này sẽ xóa(1)  -->

                        <!--  Pagination  -->
                        <!--<Grid
                            Grid.Row="1"
                            Margin="0,8,0,0"
                            Padding="16,8,16,0"
                            BorderBrush="#E5E7EB"
                            BorderThickness="1,1,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>-->

                        <!--  Left: summary  -->
                        <!--<TextBlock
                                Grid.Column="0"
                                VerticalAlignment="Center"
                                FontSize="12"
                                Foreground="#6B7280"
                                Text="Showing 1 to 8 of 8 products" />-->
                        <!--  Sau này binding: Showing {StartIndex} to {EndIndex} of {TotalProducts}  -->

                        <!--  Right: Prev / Page / Next  -->
                        <!--<StackPanel
                                Grid.Column="1"
                                Orientation="Horizontal"
                                Spacing="8">
                                <Button
                                    Padding="8,4"
                                    Background="White"
                                    BorderBrush="#E5E7EB"
                                    BorderThickness="1"
                                    Click="PrevPageButton_Click"
                                    CornerRadius="6">
                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                        <FontIcon
                                            Width="16"
                                            Height="16"
                                            Glyph="&#xE76B;" />
                                        <TextBlock FontSize="12" Text="Prev" />
                                    </StackPanel>
                                </Button>

                                <TextBlock
                                    VerticalAlignment="Center"
                                    FontSize="12"
                                    Foreground="#6B7280"
                                    Text="Page 1 of 1" />
                        -->
                        <!--  sau này binding CurrentPage / TotalPages  -->

                        <!--<Button
                                    Padding="8,4"
                                    Background="White"
                                    BorderBrush="#E5E7EB"
                                    BorderThickness="1"
                                    Click="NextPageButton_Click"
                                    CornerRadius="6">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock FontSize="12" Text="Next" />
                                        <FontIcon
                                            Width="16"
                                            Height="16"
                                            Glyph="&#xE76C;" />
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </Grid>-->
                        <!--  Sau này sẽ xóa(1)  -->



                        <!--  Pagination  -->
                        <pagination:PaginationControl
                            Grid.Row="1"
                            Margin="0,16,0,0"
                            CurrentPage="1"
                            PageSize="10"
                            TotalItems="8" />

                    </Grid>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!--  ADD PRODUCT DIALOG (BEFORE: Dialog trong React)  -->
        <ContentDialog
            x:Name="AddProductDialog"
            Title="Add New Product"
            DefaultButton="Primary"
            PrimaryButtonClick="AddProductDialog_PrimaryButtonClick"
            PrimaryButtonText="Save Product"
            SecondaryButtonClick="AddProductDialog_SecondaryButtonClick"
            SecondaryButtonText="Cancel">
            <StackPanel Spacing="12">
                <!--  Name  -->
                <StackPanel>
                    <TextBlock Margin="0,0,0,4" Text="Product Name *" />
                    <TextBox
                        x:Name="NewNameTextBox"
                        BorderBrush="#E5E7EB"
                        BorderThickness="1"
                        PlaceholderText="Enter product name" />
                </StackPanel>

                <!--  Category + Stock  -->
                <Grid ColumnSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!--  Category  -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Margin="0,0,0,4" Text="Category *" />
                        <ComboBox
                            x:Name="NewCategoryComboBox"
                            HorizontalAlignment="Stretch"
                            BorderBrush="#E5E7EB"
                            BorderThickness="1"
                            PlaceholderText="Select category">
                            <ComboBoxItem Content="Smartphones" />
                            <ComboBoxItem Content="Laptops" />
                            <ComboBoxItem Content="Audio" />
                            <ComboBoxItem Content="Tablets" />
                            <ComboBoxItem Content="Wearables" />
                        </ComboBox>
                    </StackPanel>

                    <!--  Stock  -->
                    <StackPanel Grid.Column="1">
                        <TextBlock Margin="0,0,0,4" Text="Stock *" />
                        <TextBox
                            x:Name="NewStockTextBox"
                            BorderBrush="#E5E7EB"
                            BorderThickness="1"
                            InputScope="Number"
                            PlaceholderText="0" />
                    </StackPanel>
                </Grid>

                <!--  Price + Import price  -->
                <Grid ColumnSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Margin="0,0,0,4" Text="Sale Price *" />
                        <TextBox
                            x:Name="NewPriceTextBox"
                            BorderBrush="#E5E7EB"
                            BorderThickness="1"
                            InputScope="Number"
                            PlaceholderText="0.00" />
                    </StackPanel>

                    <StackPanel Grid.Column="1">
                        <TextBlock Margin="0,0,0,4" Text="Import Price" />
                        <TextBox
                            x:Name="NewImportPriceTextBox"
                            BorderBrush="#E5E7EB"
                            BorderThickness="1"
                            InputScope="Number"
                            PlaceholderText="0.00" />
                    </StackPanel>
                </Grid>

                <!--  Description  -->
                <StackPanel>
                    <TextBlock Margin="0,0,0,4" Text="Description" />
                    <TextBox
                        x:Name="NewDescriptionTextBox"
                        MinHeight="80"
                        AcceptsReturn="True"
                        BorderBrush="#E5E7EB"
                        BorderThickness="1"
                        TextWrapping="Wrap" />
                </StackPanel>
            </StackPanel>
        </ContentDialog>

    </Grid>
</Page>
