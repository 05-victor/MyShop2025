<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="MyShop.Client.Views.Admin.AdminAgentRequestsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:badges="using:MyShop.Client.Views.Components.Badges"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:MyShop.Client.ViewModels.Admin"
    x:Name="MyPage"
    Background="#F3F4F6"
    mc:Ignorable="d">

    <Page.Resources>
        <!-- No custom styles needed - TabView uses built-in WinUI 3 styles -->
    </Page.Resources>





    <Grid Padding="32">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Header  -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock
                    Style="{StaticResource DisplayHeadingStyle}"
                    Text="Agent Requests" />
                <TextBlock
                    Margin="0,4,0,0"
                    FontSize="14"
                    Foreground="#6B7280"
                    Text="Manage salesman registration requests" />
            </StackPanel>

            <Button
                Grid.Column="1"
                VerticalAlignment="Center"
                Command="{x:Bind ViewModel.RefreshCommand}"
                Style="{StaticResource AccentButtonStyle}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontSize="16" Glyph="&#xE72C;" />
                    <TextBlock Text="Refresh" />
                </StackPanel>
            </Button>
        </Grid>

        <!--  Status Tabs - Using TabView  -->
        <TabView
            Grid.Row="1"
            Margin="0,0,0,16"
            IsAddTabButtonVisible="False"
            SelectedIndex="{x:Bind ViewModel.SelectedTabIndex, Mode=TwoWay}"
            TabWidthMode="SizeToContent">
            
            <!--  All Requests Tab  -->
            <TabViewItem Header="All Requests" IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE8FD;" />
                </TabViewItem.IconSource>
            </TabViewItem>

            <!--  Pending Tab  -->
            <TabViewItem Header="Pending" IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE9F5;" />
                </TabViewItem.IconSource>
            </TabViewItem>

            <!--  Approved Tab  -->
            <TabViewItem Header="Approved" IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE73E;" />
                </TabViewItem.IconSource>
            </TabViewItem>

            <!--  Rejected Tab  -->
            <TabViewItem Header="Rejected" IsClosable="False">
                <TabViewItem.IconSource>
                    <FontIconSource Glyph="&#xE711;" />
                </TabViewItem.IconSource>
            </TabViewItem>
        </TabView>

        <!--  Requests Cards  -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="16">
                <!--  Empty State  -->
                <Border
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="#E5E7EB"
                    BorderThickness="1"
                    CornerRadius="16"
                    Padding="48"
                    Visibility="{x:Bind ViewModel.HasNoRequests, Mode=OneWay}">
                    <Border.Shadow>
                        <ThemeShadow />
                    </Border.Shadow>
                    <StackPanel
                        HorizontalAlignment="Center"
                        Spacing="16">
                        <FontIcon
                            FontSize="48"
                            Foreground="#9CA3AF"
                            Glyph="&#xE823;"
                            HorizontalAlignment="Center" />
                        <TextBlock
                            FontSize="16"
                            Foreground="#6B7280"
                            Text="No requests found"
                            HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>

                <!--  Request Cards  -->
                <ItemsRepeater ItemsSource="{x:Bind ViewModel.FilteredRequests, Mode=OneWay}">
                    <ItemsRepeater.Layout>
                        <StackLayout Spacing="16" />
                    </ItemsRepeater.Layout>
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="viewmodels:AgentRequestItem">
                            <Border
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="#E5E7EB"
                                BorderThickness="1"
                                CornerRadius="16"
                                Padding="24">
                                <Border.Shadow>
                                    <ThemeShadow />
                                </Border.Shadow>

                                <Grid RowSpacing="16">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <!--  Header  -->
                                        <RowDefinition Height="Auto" />
                                        <!--  Reason & Experience  -->
                                        <RowDefinition Height="Auto" />
                                        <!--  Rejection (conditional)  -->
                                        <RowDefinition Height="Auto" />
                                        <!--  Actions  -->
                                    </Grid.RowDefinitions>

                                    <!--  Header Section: Avatar + Name + Badge + Email + Date  -->
                                    <Grid Grid.Row="0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <!--  Avatar  -->
                                        <PersonPicture
                                            Grid.Column="0"
                                            Width="48"
                                            Height="48"
                                            Margin="0,0,16,0"
                                            ProfilePicture="{x:Bind Avatar}" />

                                        <!--  Name, Badge, Email, Date  -->
                                        <StackPanel Grid.Column="1" Spacing="8">
                                            <!--  Name + Status Badge  -->
                                            <StackPanel Orientation="Horizontal" Spacing="12">
                                                <TextBlock
                                                    FontSize="16"
                                                    FontWeight="SemiBold"
                                                    Foreground="#111827"
                                                    Text="{x:Bind FullName}"
                                                    VerticalAlignment="Center" />
                                                <badges:StatusBadge
                                                    Text="{x:Bind Status}"
                                                    Variant="Warning" />
                                            </StackPanel>

                                            <!--  Email + Date  -->
                                            <StackPanel Orientation="Horizontal" Spacing="16">
                                                <StackPanel Orientation="Horizontal" Spacing="6">
                                                    <FontIcon
                                                        FontSize="14"
                                                        Foreground="#6B7280"
                                                        Glyph="&#xE715;" />
                                                    <TextBlock
                                                        FontSize="13"
                                                        Foreground="#6B7280"
                                                        Text="{x:Bind Email}" />
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal" Spacing="6">
                                                    <FontIcon
                                                        FontSize="14"
                                                        Foreground="#6B7280"
                                                        Glyph="&#xE787;" />
                                                    <TextBlock
                                                        FontSize="13"
                                                        Foreground="#6B7280"
                                                        Text="{x:Bind SubmittedDate}" />
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>

                                    <!--  Reason & Experience Section  -->
                                    <StackPanel Grid.Row="1" Spacing="12">
                                        <!--  Reason  -->
                                        <StackPanel Spacing="8">
                                            <TextBlock
                                                FontSize="13"
                                                FontWeight="SemiBold"
                                                Foreground="#111827"
                                                Text="Reason:" />
                                            <Border
                                                Background="#F9FAFB"
                                                CornerRadius="8"
                                                Padding="12">
                                                <TextBlock
                                                    FontSize="13"
                                                    Foreground="#6B7280"
                                                    Text="{x:Bind Reason}"
                                                    TextWrapping="Wrap" />
                                            </Border>
                                        </StackPanel>

                                        <!--  Experience  -->
                                        <StackPanel Spacing="8">
                                            <TextBlock
                                                FontSize="13"
                                                FontWeight="SemiBold"
                                                Foreground="#111827"
                                                Text="Experience:" />
                                            <Border
                                                Background="#F9FAFB"
                                                CornerRadius="8"
                                                Padding="12">
                                                <TextBlock
                                                    FontSize="13"
                                                    Foreground="#6B7280"
                                                    Text="{x:Bind Experience}"
                                                    TextWrapping="Wrap" />
                                            </Border>
                                        </StackPanel>
                                    </StackPanel>

                                    <!--  Rejection Reason (only if rejected)  -->
                                    <StackPanel
                                        Grid.Row="2"
                                        Spacing="8"
                                        Visibility="{x:Bind HasRejectionReason}">
                                        <TextBlock
                                            FontSize="13"
                                            FontWeight="SemiBold"
                                            Foreground="#B91C1C"
                                            Text="Rejection Reason:" />
                                        <Border
                                            Background="#FEF2F2"
                                            BorderBrush="#FCA5A5"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="12">
                                            <TextBlock
                                                FontSize="13"
                                                Foreground="#DC2626"
                                                Text="{x:Bind RejectionReason}"
                                                TextWrapping="Wrap" />
                                        </Border>
                                    </StackPanel>

                                    <!--  Action Buttons (only for pending)  -->
                                    <StackPanel
                                        Grid.Row="3"
                                        BorderBrush="#E5E7EB"
                                        BorderThickness="0,1,0,0"
                                        Orientation="Horizontal"
                                        Padding="0,16,0,0"
                                        Spacing="12"
                                        Visibility="{x:Bind IsPending}">
                                        <Button
                                            Command="{Binding DataContext.ApproveRequestCommand, ElementName=MyPage}"
                                            CommandParameter="{x:Bind}"
                                            Style="{StaticResource AccentButtonStyle}">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon FontSize="14" Glyph="&#xE73E;" />
                                                <TextBlock Text="Approve" />
                                            </StackPanel>
                                        </Button>
                                        <Button
                                            Command="{Binding DataContext.RejectRequestCommand, ElementName=MyPage}"
                                            CommandParameter="{x:Bind}"
                                            Style="{StaticResource DefaultButtonStyle}">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon
                                                    FontSize="14"
                                                    Foreground="#DC2626"
                                                    Glyph="&#xE711;" />
                                                <TextBlock Foreground="#DC2626" Text="Reject" />
                                            </StackPanel>
                                        </Button>
                                        <Button Style="{StaticResource DefaultButtonStyle}">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <FontIcon FontSize="14" Glyph="&#xE77B;" />
                                                <TextBlock Text="View Profile" />
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
