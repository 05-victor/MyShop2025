<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MyShop.Client.Views.Customer.CustomerDashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:MyShop.Client.ViewModels.Customer"
    xmlns:components="using:MyShop.Client.Views.Components"
    xmlns:converters="using:MyShop.Client.Common.Converters"
    mc:Ignorable="d"
    Background="#F5F7FA">

    <Page.Transitions>
        <TransitionCollection>
            <EntranceThemeTransition FromVerticalOffset="50"/>
        </TransitionCollection>
    </Page.Transitions>

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
    </Page.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Padding="24" RowSpacing="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <StackPanel Grid.Row="0" Spacing="16">
            
            <!-- Become Admin Banner (shows when no admin exists) -->
            <components:BecomeAdminBanner 
                x:Name="BecomeAdminBannerControl"
                Visibility="{x:Bind ViewModel.ShowBecomeAdminBanner, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                ActivationSuccessful="OnActivationSuccessful"/>

            <!-- Email Verification Warning -->
            <InfoBar 
                Severity="Warning"
                Title="Email Verification Required"
                Message="Please verify your email to access all features"
                IsOpen="{x:Bind ViewModel.IsVerified, Mode=OneWay, Converter={StaticResource InverseBoolConverter}}"
                IsClosable="False">
                <InfoBar.ActionButton>
                    <Button Content="Resend Email" Style="{StaticResource AccentButtonStyle}"/>
                </InfoBar.ActionButton>
            </InfoBar>

            <!-- Welcome Section -->
            <Border Style="{StaticResource CardWithShadowStyle}"
                   Padding="24">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Spacing="8">
                        <TextBlock Text="{x:Bind ViewModel.WelcomeMessage, Mode=OneWay}"
                                  FontSize="28"
                                  FontWeight="Bold"
                                  TextWrapping="Wrap"
                                  Foreground="#1B1D1F"/>
                        <TextBlock Text="Discover amazing products and great deals"
                                  FontSize="14"
                                  Foreground="#4A5568"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" 
                               Orientation="Horizontal" 
                               Spacing="12"
                               VerticalAlignment="Center">
                        <Button Click="OnBecomeAgentClick"
                               BorderBrush="#E5E7EB"
                               Background="White"
                               MinWidth="160">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE735;" FontSize="16" Foreground="#00AEEF"/>
                                <TextBlock Text="Become Agent" FontSize="14" FontWeight="SemiBold" Foreground="#1B1D1F"/>
                            </StackPanel>
                        </Button>
                        <Button Style="{StaticResource PrimaryButtonStyle}"
                               MinWidth="120">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE719;" FontSize="16"/>
                                <TextBlock Text="Shop Now" FontSize="14" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            </StackPanel>
            
            <!-- Main Content -->
            <StackPanel Grid.Row="1" Spacing="20">
            
            <!-- Featured Products Section -->
            <StackPanel Spacing="16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                              Text="Featured Products" 
                              FontSize="24" 
                              FontWeight="Bold"
                              Foreground="#111827"/>
                    
                    <HyperlinkButton Grid.Column="1"
                                    Content="View All →"
                                    FontSize="14"
                                    Foreground="#00AEEF"/>
                </Grid>

                <!-- Changed to {Binding} for async loaded API data -->
                <ItemsRepeater ItemsSource="{Binding FeaturedProducts, Mode=OneWay}">
                    <ItemsRepeater.Layout>
                        <UniformGridLayout MinItemWidth="250" 
                                         MinItemHeight="320" 
                                         ItemsStretch="Fill" 
                                         MinRowSpacing="20" 
                                         MinColumnSpacing="20"/>
                    </ItemsRepeater.Layout>
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="viewmodels:FeaturedProductItem">
                            <Border Style="{StaticResource ProductCardStyle}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="180"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Product Image -->
                                    <Border Grid.Row="0"
                                           Background="#F9FAFB"
                                           CornerRadius="8"
                                           Margin="0,0,0,12">
                                        <Image Source="{x:Bind Image}"
                                              Stretch="UniformToFill"/>
                                    </Border>

                                    <!-- Product Info -->
                                    <StackPanel Grid.Row="1" Spacing="8">
                                        <TextBlock Text="{x:Bind Category}"
                                                  FontSize="12"
                                                  Foreground="#6B7280"
                                                  TextTrimming="CharacterEllipsis"/>
                                        
                                        <TextBlock Text="{x:Bind Name}"
                                                  FontSize="16"
                                                  FontWeight="SemiBold"
                                                  Foreground="#111827"
                                                  TextWrapping="Wrap"
                                                  MaxLines="2"/>

                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Rating -->
                                            <StackPanel Grid.Column="0" 
                                                       Orientation="Horizontal" 
                                                       Spacing="4">
                                                <FontIcon Glyph="&#xE735;" 
                                                         FontSize="14" 
                                                         Foreground="#F59E0B"/>
                                                <TextBlock Text="{x:Bind Rating}"
                                                          FontSize="13"
                                                          Foreground="#111827"/>
                                                <TextBlock Text="{x:Bind Reviews, Mode=OneTime}"
                                                          FontSize="12"
                                                          Foreground="#6B7280"/>
                                            </StackPanel>
                                        </Grid>

                                        <!-- Price -->
                                        <TextBlock FontSize="20"
                                                  FontWeight="Bold"
                                                  Foreground="#1A4D8F">
                                            <Run Text="$"/>
                                            <Run Text="{x:Bind Price}"/>
                                        </TextBlock>

                                        <!-- Add to Cart Button -->
                                        <Button HorizontalAlignment="Stretch"
                                               Background="#00AEEF"
                                               Foreground="White"
                                               BorderThickness="0"
                                               CornerRadius="8"
                                               Padding="0,10">
                                            <Button.Resources>
                                                <SolidColorBrush x:Key="ButtonBackgroundPointerOver" Color="#0096D1"/>
                                                <SolidColorBrush x:Key="ButtonBackgroundPressed" Color="#007DAF"/>
                                            </Button.Resources>
                                            <StackPanel Orientation="Horizontal" 
                                                       Spacing="8"
                                                       HorizontalAlignment="Center">
                                                <FontIcon Glyph="&#xE7BF;" FontSize="16"/>
                                                <TextBlock Text="Add to Cart" FontSize="14" FontWeight="SemiBold"/>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
            </StackPanel>

            <!-- Recommended Products Section -->
            <StackPanel Spacing="16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                              Text="Recommended for You" 
                              FontSize="24" 
                              FontWeight="Bold"
                              Foreground="#111827"/>
                    
                    <HyperlinkButton Grid.Column="1"
                                    Content="View All →"
                                    FontSize="14"
                                    Foreground="#00AEEF"/>
                </Grid>

                <!-- Changed to {Binding} for async loaded API data -->
                <ItemsRepeater ItemsSource="{Binding RecommendedProducts, Mode=OneWay}">
                    <ItemsRepeater.Layout>
                        <UniformGridLayout MinItemWidth="250" 
                                         MinItemHeight="320" 
                                         ItemsStretch="Fill" 
                                         MinRowSpacing="20" 
                                         MinColumnSpacing="20"/>
                    </ItemsRepeater.Layout>
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="viewmodels:RecommendedProductItem">
                            <Border Style="{StaticResource ProductCardStyle}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="180"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Product Image -->
                                    <Border Grid.Row="0"
                                           Background="#F9FAFB"
                                           CornerRadius="8"
                                           Margin="0,0,0,12">
                                        <Image Source="{x:Bind Image}"
                                              Stretch="UniformToFill"/>
                                    </Border>

                                    <!-- Product Info -->
                                    <StackPanel Grid.Row="1" Spacing="8">
                                        <TextBlock Text="{x:Bind Category}"
                                                  FontSize="12"
                                                  Foreground="#6B7280"
                                                  TextTrimming="CharacterEllipsis"/>
                                        
                                        <TextBlock Text="{x:Bind Name}"
                                                  FontSize="16"
                                                  FontWeight="SemiBold"
                                                  Foreground="#111827"
                                                  TextWrapping="Wrap"
                                                  MaxLines="2"/>

                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Rating -->
                                            <StackPanel Grid.Column="0" 
                                                       Orientation="Horizontal" 
                                                       Spacing="4">
                                                <FontIcon Glyph="&#xE735;" 
                                                         FontSize="14" 
                                                         Foreground="#F59E0B"/>
                                                <TextBlock Text="{x:Bind Rating}"
                                                          FontSize="13"
                                                          Foreground="#111827"/>
                                                <TextBlock Text="{x:Bind Reviews, Mode=OneTime}"
                                                          FontSize="12"
                                                          Foreground="#6B7280"/>
                                            </StackPanel>
                                        </Grid>

                                        <!-- Price -->
                                        <TextBlock FontSize="20"
                                                  FontWeight="Bold"
                                                  Foreground="#1A4D8F">
                                            <Run Text="$"/>
                                            <Run Text="{x:Bind Price}"/>
                                        </TextBlock>

                                        <!-- Add to Cart Button -->
                                        <Button HorizontalAlignment="Stretch"
                                               Background="#00AEEF"
                                               Foreground="White"
                                               BorderThickness="0"
                                               CornerRadius="8"
                                               Padding="0,10">
                                            <Button.Resources>
                                                <SolidColorBrush x:Key="ButtonBackgroundPointerOver" Color="#0096D1"/>
                                                <SolidColorBrush x:Key="ButtonBackgroundPressed" Color="#007DAF"/>
                                            </Button.Resources>
                                            <StackPanel Orientation="Horizontal" 
                                                       Spacing="8"
                                                       HorizontalAlignment="Center">
                                                <FontIcon Glyph="&#xE7BF;" FontSize="16"/>
                                                <TextBlock Text="Add to Cart" FontSize="14" FontWeight="SemiBold"/>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
            </StackPanel>

            </StackPanel>
        </Grid>
    </ScrollViewer>
</Page>
