<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MyShop.Client.Views.LoginView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:MyShop.Client.Converters"
    xmlns:local="using:MyShop.Client.Views"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <converters:BoolNegationConverter x:Key="BoolNegationConverter"/>
    </Page.Resources>

    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
        <Grid MinWidth="800" MinHeight="600">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Cột trái: Logo và branding -->
            <Grid Grid.Column="0" Padding="74 64 36 78" Background="{ThemeResource AccentAcrylicBackgroundFillColorBaseBrush}">
                <Grid Background="{ThemeResource ControlStrokeColorDefaultBrush}"
                      Margin="0 16 0 0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                    <Rectangle Fill="{ThemeResource SystemColorHighlightColorBrush}" Opacity="0.3"/>
                    <TextBlock Text="MyShop2025"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               FontSize="40"
                               FontWeight="Bold"
                               Foreground="White"
                               TextWrapping="Wrap"/>
                </Grid>
            </Grid>

            <!-- Cột phải: Form đăng nhập -->
            <Grid Grid.Column="1" Padding="36 78 74 78" Background="{ThemeResource AccentAcrylicBackgroundFillColorBaseBrush}">
                <Border Background="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                        HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>

                <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                    <StackPanel MaxWidth="400" Spacing="12" Padding="20">
                        <FontIcon Glyph="&#xE912;" Foreground="{ThemeResource SystemColorHighlightColor}"
                                  FontFamily="Segoe MDL2 Assets" FontSize="40"
                                  HorizontalAlignment="Center" Margin="0 0 0 8"/>
                        <TextBlock Text="Welcome back!" FontSize="28"
                                   FontWeight="SemiBold" Margin="0 0 0 4"
                                   Foreground="{ThemeResource TextFillColorPrimaryBrush}" 
                                   TextAlignment="Center"/>
                        <TextBlock Text="Enter to get unlimited access to data &amp; information."
                                   Foreground="{ThemeResource TextFillColorDisabledBrush}" FontSize="14"
                                   FontWeight="Normal" Margin="0 0 0 16"
                                   TextAlignment="Center"/>
                        
                        <!-- Username/Email -->
                        <StackPanel Spacing="4">
                            <TextBox x:Name="UsernameTextBox"
                                     PlaceholderText="Enter your email address or username"
                                     Width="340"
                                     HorizontalAlignment="Center"
                                     Padding="12"
                                     Text="{x:Bind ViewModel.Username, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     InputScope="Default"
                                     KeyDown="Input_KeyDown"
                                     IsEnabled="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}"
                                     Background="{ThemeResource TextControlBackground}"
                                     BorderThickness="1"
                                     CornerRadius="4">
                                <TextBox.Header>
                                    <TextBlock Margin="0 0 0 4">
                                        <Run Text="Email/Username" Foreground="{ThemeResource TextFillColorPrimaryBrush}" FontSize="14"/>
                                        <Run Text="*" Foreground="Red" FontSize="14"/>
                                    </TextBlock>
                                </TextBox.Header>
                            </TextBox>
                            <TextBlock Text="{x:Bind ViewModel.UsernameError, Mode=OneWay}"
                                       Foreground="{ThemeResource SystemErrorTextColor}" 
                                       FontSize="12"
                                       TextAlignment="Center"
                                       Visibility="{x:Bind ViewModel.UsernameError, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}"/>
                        </StackPanel>
                        
                        <!-- Password -->
                        <StackPanel Spacing="4">
                            <PasswordBox x:Name="PasswordInput"
                                         PlaceholderText="Enter password"
                                         Width="340"
                                         HorizontalAlignment="Center"
                                         Padding="12"
                                         PasswordChanged="PasswordInput_PasswordChanged"
                                         KeyDown="Input_KeyDown"
                                         IsEnabled="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}"
                                         Background="{ThemeResource TextControlBackground}"
                                         BorderThickness="1"
                                         CornerRadius="4">
                                <PasswordBox.Header>
                                    <TextBlock Margin="0 0 0 4">
                                        <Run Text="Password" Foreground="{ThemeResource TextFillColorPrimaryBrush}" FontSize="14"/>
                                        <Run Text="*" Foreground="Red" FontSize="14"/>
                                    </TextBlock>
                                </PasswordBox.Header>
                            </PasswordBox>
                            <TextBlock Text="{x:Bind ViewModel.PasswordError, Mode=OneWay}"
                                       Foreground="{ThemeResource SystemErrorTextColor}" 
                                       FontSize="12"
                                       TextAlignment="Center"
                                       Visibility="{x:Bind ViewModel.PasswordError, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}"/>
                        </StackPanel>
                        
                        <!-- Remember Me & Forgot Password -->
                        <Grid Width="340" HorizontalAlignment="Center" Margin="0 4 0 0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <CheckBox x:Name="RememberMeCheckBox"
                                      Grid.Column="0"
                                      Content="Remember me"
                                      IsChecked="{x:Bind ViewModel.IsRememberMe, Mode=TwoWay}"/>
                            <HyperlinkButton Grid.Column="1"
                                             Content="Forgot password?"
                                             FontSize="13"
                                             Command="{x:Bind ViewModel.ForgotPasswordCommand}"/>
                        </Grid>
                        
                        <!-- Error Message -->
                        <TextBlock Text="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                                   Foreground="{ThemeResource SystemErrorTextColor}" 
                                   FontSize="13"
                                   Margin="0 4 0 0"
                                   TextWrapping="Wrap"
                                   TextAlignment="Center"
                                   MaxWidth="340"
                                   Visibility="{x:Bind ViewModel.ErrorMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}"/>
                        
                        <!-- Login Button -->
                        <Button x:Name="LoginButton"
                                Width="340"
                                HorizontalAlignment="Center"
                                Margin="0 8 0 0"
                                Background="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                                Padding="12"
                                Command="{x:Bind ViewModel.AttemptLoginCommand}"
                                Style="{StaticResource AccentButtonStyle}"
                                IsEnabled="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <ProgressRing Width="16" Height="16"
                                              IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                                              Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                <TextBlock Text="Log In" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <!-- Divider -->
                        <Grid VerticalAlignment="Center" Margin="0 12 0 8"
                              Width="340" HorizontalAlignment="Center">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Height="1" VerticalAlignment="Center" 
                                    Background="{ThemeResource TextControlBorderBrush}"/>
                            <TextBlock Grid.Column="1" Text="Or, Login with" 
                                       Margin="12 0" Opacity="0.7" FontSize="12"/>
                            <Border Grid.Column="2" Height="1" VerticalAlignment="Center" 
                                    Background="{ThemeResource TextControlBorderBrush}"/>
                        </Grid>
                        
                        <!-- Google Login Button -->
                        <Button Width="340"
                                HorizontalAlignment="Center"
                                Padding="12"
                                Command="{x:Bind ViewModel.GoogleLoginCommand}"
                                IsEnabled="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}"
                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <Image Source="/Assets/Google.png" Width="16" Height="16"/>
                                <TextBlock Text="Sign in with Google" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <!-- Register Link -->
                        <StackPanel Orientation="Horizontal" Spacing="4"
                                    HorizontalAlignment="Center"
                                    Margin="0 12 0 0">
                            <TextBlock Text="Don't have an account?" 
                                       VerticalAlignment="Center"
                                       FontSize="13"/>
                            <HyperlinkButton VerticalAlignment="Center"
                                             Command="{x:Bind ViewModel.NavigateToRegisterCommand}"
                                             Padding="4 0">
                                <TextBlock Text="Register here"
                                           TextDecorations="Underline"
                                           FontSize="13"
                                           Foreground="{ThemeResource AccentTextFillColorTertiaryBrush}"/>
                            </HyperlinkButton>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Grid>

            <!-- Loading Overlay -->
            <Border Grid.ColumnSpan="2"
                    Background="#80000000"
                    Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16">
                    <ProgressRing IsActive="True" Width="48" Height="48"/>
                    <TextBlock Text="Đang đăng nhập..." FontSize="16"
                               HorizontalAlignment="Center"
                               Foreground="White"/>
                </StackPanel>
            </Border>
        </Grid>
    </ScrollViewer>
</Page>