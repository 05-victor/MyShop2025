<?xml version="1.0" encoding="utf-8"?>
<!--
    Trang đăng nhập với giao diện 2 cột hiện đại.
    Layout bao gồm:
    - Cột trái: Logo và branding
    - Cột phải: Form đăng nhập với validation và các tính năng bổ sung
-->
<Page
    x:Class="MyShop.Client.Views.LoginView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Cột trái: Logo và branding -->
            <Grid Grid.Column="0" Padding="74 64 0 78" Background="{ThemeResource AccentAcrylicBackgroundFillColorBaseBrush}">
                <Grid Background="{ThemeResource ControlStrokeColorDefaultBrush}"
					  Margin="36 16 0 0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                    <!-- Placeholder cho image - có thể thay bằng logo thực tế -->
                    <Rectangle Fill="{ThemeResource SystemColorHighlightColorBrush}" Opacity="0.3"/>

                    <TextBlock Text="MyShop2025"
							   HorizontalAlignment="Center"
							   VerticalAlignment="Center"
							   FontSize="40"
							   FontWeight="Bold"
							   Foreground="White"
							   TextWrapping="Wrap"/>
                </Grid>
            </Grid>

            <!-- Cột phải: Form đăng nhập -->
            <Grid Grid.Column="1" Padding="0 78 74 78" Background="{ThemeResource AccentAcrylicBackgroundFillColorBaseBrush}">
                <Border Background="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
						HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>

                <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                    <StackPanel Width="350" Spacing="10">
                        <!-- Icon và tiêu đề -->
                        <FontIcon Glyph="&#xE912;" Foreground="{ThemeResource SystemColorHighlightColor}"
								  FontFamily="Segoe MDL2 Assets" FontSize="40"
								  HorizontalAlignment="Left" Margin="36 16 0 0"/>

                        <TextBlock Text="Welcome back!" FontSize="28"
								   FontWeight="SemiBold" Margin="36 16 0 0"
								   Foreground="{ThemeResource TextFillColorPrimaryBrush}" TextAlignment="Left"/>

                        <TextBlock Text="Enter to get unlimited access to data &amp; information."
								   Foreground="{ThemeResource TextFillColorDisabledBrush}" FontSize="16"
								   FontWeight="SemiBold" Margin="36 4 0 0"
								   TextAlignment="Left"/>

                        <!-- Trường Email/Username -->
                        <StackPanel Spacing="5">
                            <TextBox x:Name="UsernameTextBox"
									 PlaceholderText="Enter your email address or username"
									 BorderBrush="LightGray" Width="300"
									 HorizontalAlignment="Left" Margin="36 16 0 0"
									 Padding="12"
									 Text="{x:Bind ViewModel.Username, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
									 InputScope="Default"
									 KeyDown="Input_KeyDown"
									 IsEnabled="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}"
									 Background="{ThemeResource TextControlBackground}"
									 BorderThickness="1"
									 CornerRadius="4">
                                <TextBox.Header>
                                    <TextBlock>
										<Run Text="Email/Username" Foreground="{ThemeResource TextFillColorPrimaryBrush}" FontSize="16"/>
										<Run Text="*" Foreground="Red" FontSize="16"/>
                                    </TextBlock>
                                </TextBox.Header>
                            </TextBox>

                            <!-- Lỗi validation cho Username -->
                            <TextBlock Text="{x:Bind ViewModel.UsernameError, Mode=OneWay}"
									   Foreground="{ThemeResource SystemErrorTextColor}" 
									   FontSize="12"
									   Margin="36 0 0 0"
									   Visibility="{x:Bind ViewModel.UsernameError, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}"/>
                        </StackPanel>

                        <!-- Trường Password -->
                        <StackPanel Spacing="5">
                            <PasswordBox x:Name="PasswordInput"
										PlaceholderText="Enter password"
										BorderBrush="LightGray" 
										Width="300"
										HorizontalAlignment="Left" 
										Margin="36 4 0 0"
										Padding="12"
										PasswordChanged="PasswordInput_PasswordChanged"
										KeyDown="Input_KeyDown"
										IsEnabled="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}"
										Background="{ThemeResource TextControlBackground}"
										BorderThickness="1"
										CornerRadius="4">
                                <PasswordBox.Header>
                                    <TextBlock>
										<Run Text="Password" Foreground="{ThemeResource TextFillColorPrimaryBrush}" FontSize="16"/>
										<Run Text="*" Foreground="Red" FontSize="16"/>
                                    </TextBlock>
                                </PasswordBox.Header>
                            </PasswordBox>

                            <!-- Lỗi validation cho Password -->
                            <TextBlock Text="{x:Bind ViewModel.PasswordError, Mode=OneWay}"
									   Foreground="{ThemeResource SystemErrorTextColor}" 
									   FontSize="12"
									   Margin="36 0 0 0"
									   Visibility="{x:Bind ViewModel.PasswordError, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}"/>
                        </StackPanel>

                        <!-- Remember me và Forgot password -->
                        <Grid Padding="36 0 0 0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <CheckBox x:Name="RememberMeCheckBox"
									  Grid.Column="0"
									  Content="Remember me"
									  IsChecked="{x:Bind ViewModel.IsRememberMe, Mode=TwoWay}"/>
                            <HyperlinkButton Grid.Column="1"
											 Content="Forgot your password ?"
											 Command="{x:Bind ViewModel.ForgotPasswordCommand}"/>
                        </Grid>

                        <!-- Thông báo lỗi chung -->
                        <TextBlock Text="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
								   Foreground="{ThemeResource SystemErrorTextColor}" 
								   FontSize="14"
								   Margin="36 5 0 0" 
								   TextWrapping="Wrap"
								   Visibility="{x:Bind ViewModel.ErrorMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}"/>

                        <!-- Nút Log In với loading -->
                        <Button x:Name="LoginButton"
								Width="300"
								HorizontalAlignment="Left" 
								Margin="36 15 0 0"
								Background="{ThemeResource AccentTextFillColorPrimaryBrush}"
								Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
								Padding="12"
								Command="{x:Bind ViewModel.AttemptLoginCommand}"
								Style="{StaticResource AccentButtonStyle}"
								IsEnabled="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <ProgressRing Width="16" Height="16"
											  IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
											  Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                <TextBlock Text="Log In" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <!-- Divider -->
                        <Grid VerticalAlignment="Center" Margin="36 10 0 0"
							  Width="300" HorizontalAlignment="Left">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0"
									Height="1"
									VerticalAlignment="Center"
									Background="{ThemeResource TextControlBorderBrush}"/>

                            <TextBlock Grid.Column="1"
									   Text="Or, Login with"
									   Margin="15 0"
									   Opacity="0.7"/>

                            <Border Grid.Column="2"
									Height="1"
									VerticalAlignment="Center"
									Background="{ThemeResource TextControlBorderBrush}"/>
                        </Grid>

                        <!-- Sign up with Google -->
                        <Button Width="300" Margin="36,0,0,0" Padding="12"
								Command="{x:Bind ViewModel.GoogleLoginCommand}"
								Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <!-- Placeholder cho Google icon -->
                                <FontIcon Glyph="&#xE909;" FontFamily="Segoe MDL2 Assets" Width="16" Height="16"
										  Foreground="{ThemeResource SystemColorHighlightColor}"/>
                                <TextBlock Text="Sign in with Google" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <!-- Link đến Register -->
                        <StackPanel Orientation="Horizontal" Spacing="5"
									HorizontalAlignment="Center"
									Margin="36,16,0,0">
                            <TextBlock Text="Don't have an account?" VerticalAlignment="Center"/>
                            <HyperlinkButton VerticalAlignment="Center"
											 Command="{x:Bind ViewModel.NavigateToRegisterCommand}">
                                <TextBlock Text="Register here"
										   TextDecorations="Underline"
										   Foreground="{ThemeResource AccentTextFillColorTertiaryBrush}"/>
                            </HyperlinkButton>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Grid>

            <!-- Overlay loading toàn màn hình -->
            <Border Grid.ColumnSpan="2"
					Background="#80000000"
					Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16">
                    <ProgressRing IsActive="True" Width="48" Height="48"/>
                    <TextBlock Text="Đang đăng nhập..." FontSize="16"
							   HorizontalAlignment="Center"
							   Foreground="White"/>
                </StackPanel>
            </Border>
        </Grid>
    </ScrollViewer>
</Page>