<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="MyShop.Client.Views.Components.Chat.ChatPanel"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:chat="using:MyShop.Client.Views.Components.Chat"
    mc:Ignorable="d"
    x:Name="RootControl"
    Width="380">

    <!--
    ChatPanel Component
    ===================
    Main chat UI panel with messages, input, and suggested prompts.
    -->

    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
            CornerRadius="16"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="1">
        <Border.Shadow>
            <ThemeShadow/>
        </Border.Shadow>
        
        <Grid RowSpacing="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- Header -->
                <RowDefinition Height="*"/>     <!-- Messages -->
                <RowDefinition Height="Auto"/>  <!-- Suggestions -->
                <RowDefinition Height="Auto"/>  <!-- Input -->
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" 
                   Background="{ThemeResource PrimaryBrush}"
                   CornerRadius="16,16,0,0"
                   Padding="16,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- AI Avatar -->
                    <Border Grid.Column="0" 
                           Width="36" Height="36" 
                           CornerRadius="18"
                           Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                           Margin="0,0,12,0">
                        <FontIcon Glyph="&#xE99A;" FontSize="18" Foreground="{ThemeResource PrimaryBrush}"/>
                    </Border>
                    
                    <!-- Title -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Text="AI Assistant" 
                                  FontSize="16" FontWeight="SemiBold" 
                                  Foreground="White"/>
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <Ellipse Width="8" Height="8" Fill="{ThemeResource SuccessGreenBrush}"/>
                            <TextBlock Text="Online" FontSize="12" Foreground="White" Opacity="0.8"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Clear Button -->
                    <Button Grid.Column="2"
                           Background="Transparent"
                           BorderThickness="0"
                           Padding="8"
                           ToolTipService.ToolTip="Clear chat"
                           AutomationProperties.Name="Clear chat history"
                           Click="ClearButton_Click">
                        <FontIcon Glyph="&#xE74D;" FontSize="16" Foreground="White"/>
                    </Button>
                </Grid>
            </Border>

            <!-- Messages Area -->
            <ScrollViewer Grid.Row="1" 
                         x:Name="MessagesScrollViewer"
                         VerticalScrollBarVisibility="Auto"
                         Padding="12">
                <StackPanel x:Name="MessagesPanel" Spacing="8">
                    <!-- Welcome Message -->
                    <chat:MessageBubble x:Name="WelcomeMessage"
                                       Message="Hello! I'm your AI assistant. How can I help you today?"
                                       IsUser="False"/>
                </StackPanel>
            </ScrollViewer>

            <!-- Typing Indicator -->
            <Border Grid.Row="1" 
                   x:Name="TypingIndicator"
                   HorizontalAlignment="Left"
                   VerticalAlignment="Bottom"
                   Margin="12,0,0,8"
                   Padding="12,8"
                   Background="{ThemeResource LayerFillColorDefaultBrush}"
                   CornerRadius="12"
                   Visibility="Collapsed">
                <StackPanel Orientation="Horizontal" Spacing="4">
                    <Ellipse Width="8" Height="8" Fill="{ThemeResource TextFillColorSecondaryBrush}" Opacity="0.5"/>
                    <Ellipse Width="8" Height="8" Fill="{ThemeResource TextFillColorSecondaryBrush}" Opacity="0.7"/>
                    <Ellipse Width="8" Height="8" Fill="{ThemeResource TextFillColorSecondaryBrush}" Opacity="0.9"/>
                </StackPanel>
            </Border>

            <!-- Suggested Prompts -->
            <ScrollViewer Grid.Row="2" 
                         x:Name="SuggestionsArea"
                         HorizontalScrollBarVisibility="Auto"
                         VerticalScrollBarVisibility="Disabled"
                         Padding="12,8">
                <StackPanel x:Name="SuggestionsPanel" Orientation="Horizontal" Spacing="8"/>
            </ScrollViewer>

            <!-- Input Area -->
            <Border Grid.Row="3" 
                   BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                   BorderThickness="0,1,0,0"
                   Padding="12">
                <Grid ColumnSpacing="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBox x:Name="InputTextBox"
                            Grid.Column="0"
                            PlaceholderText="Type a message..."
                            CornerRadius="20"
                            Padding="16,10"
                            BorderThickness="1"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            AutomationProperties.Name="Chat message input"
                            KeyDown="InputTextBox_KeyDown"/>
                    
                    <Button Grid.Column="1"
                           x:Name="SendButton"
                           Width="40" Height="40"
                           CornerRadius="20"
                           Background="{ThemeResource PrimaryBrush}"
                           BorderThickness="0"
                           Padding="0"
                           AutomationProperties.Name="Send message"
                           Click="SendButton_Click">
                        <FontIcon Glyph="&#xE724;" FontSize="16" Foreground="White"/>
                    </Button>
                </Grid>
            </Border>
        </Grid>
    </Border>
</UserControl>
