<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="MyShop.Client.Views.Shared.ProductBrowsePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:buttons="using:MyShop.Client.Views.Components.Buttons"
    xmlns:cards="using:MyShop.Client.Views.Components.Cards"
    xmlns:components="using:MyShop.Client.Views.Components"
    xmlns:converters="using:MyShop.Client.Common.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:MyShop.Client.ViewModels.Shared"
    xmlns:skeletons="using:MyShop.Client.Views.Components.Skeletons"
    xmlns:forms="using:MyShop.Client.Views.Components.Forms"
    xmlns:layout="using:MyShop.Client.Views.Components.Layout"
    xmlns:controls="using:MyShop.Client.Views.Components.Controls"
    Background="{ThemeResource LayerFillColorDefaultBrush}"
    UseLayoutRounding="True"
    mc:Ignorable="d">

    <Page.Transitions>
        <TransitionCollection>
            <NavigationThemeTransition/>
        </TransitionCollection>
    </Page.Transitions>

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <converters:StringFormatConverter x:Key="StringFormatConverter"/>
    </Page.Resources>

    <Grid>
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="ResponsiveStates">

                <!-- Large Desktop: 1920px+ -->
                <VisualState x:Name="LargeDesktopState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1920"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="MainContent.Padding"
                                Value="40"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- Desktop: 1280-1919px -->
                <VisualState x:Name="DesktopState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1280"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="MainContent.Padding"
                                Value="32"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- Tablet: 960-1279px -->
                <VisualState x:Name="TabletState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="960"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="MainContent.Padding"
                                Value="24"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- Tablet Portrait: 640-959px -->
                <VisualState x:Name="TabletPortraitState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="640"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="MainContent.Padding"
                                Value="20"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- Mobile: 0-639px (Default) -->
                <VisualState x:Name="MobileState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="MainContent.Padding"
                                Value="16"/>
                    </VisualState.Setters>
                </VisualState>

            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <Grid.Transitions>
            <TransitionCollection>
                <EntranceThemeTransition FromVerticalOffset="50"/>
            </TransitionCollection>
        </Grid.Transitions>

        <RefreshContainer RefreshRequested="RefreshContainer_RefreshRequested">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <Grid x:Name="MainContent"
                      Padding="32,32,32,88"
                      RowSpacing="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Page Header -->
                    <layout:PageHeader
                        Title="Shopping"
                        Subtitle="Explore our complete product collection">
                        <layout:PageHeader.ActionContent>
                            <StackPanel Orientation="Horizontal"
                                        Spacing="12">
                                <buttons:IconButton
                                    Variant="Outline"
                                    IconGlyph="&#xE72C;"
                                    Text="Refresh"
                                    Command="{x:Bind ViewModel.RefreshCommand}"
                                    ToolTipService.ToolTip="Reload products"/>
                            </StackPanel>
                        </layout:PageHeader.ActionContent>
                    </layout:PageHeader>

                    <!-- Main Content -->
                    <StackPanel Grid.Row="1"
                                Spacing="20">

                        <!--  SEARCH CARD with Auto-Complete  -->
                        <forms:SearchCard
                            x:Name="ProductSearchCard"
                            PlaceholderText="Search products..."
                            SearchText="{x:Bind ViewModel.SearchQuery, Mode=TwoWay}"
                            ShowSearchButton="Collapsed"
                            TextChanged="SearchCard_TextChanged"
                            SuggestionChosen="SearchCard_SuggestionChosen"
                            QuerySubmitted="SearchCard_QuerySubmitted"/>

                        <!--  FILTERS CARD with Apply Button  -->
                        <forms:FilterCard Title="Filters &amp; Sort"
                                          ApplyCommand="{x:Bind ViewModel.ApplyFiltersCommand}"
                                          ResetCommand="{x:Bind ViewModel.ResetFiltersCommand}"
                                          ShowActions="True"
                                          ShowResetButton="True">
                            <forms:FilterCard.FilterContent>
                                <Grid ColumnSpacing="16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!--  Category  -->
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Category"
                                                   FontSize="{StaticResource FontSize_SM}"
                                                   FontWeight="SemiBold"
                                                   Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                                   Margin="0,0,0,8"/>
                                        <ComboBox x:Name="CategoryComboBox"
                                                  HorizontalAlignment="Stretch"
                                                  Height="40"
                                                  CornerRadius="8"
                                                  BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                                  ItemsSource="{x:Bind ViewModel.Categories, Mode=OneWay}"
                                                  SelectedItem="{x:Bind ViewModel.SelectedCategory, Mode=TwoWay}"
                                                  SelectionChanged="CategoryComboBox_SelectionChanged"/>
                                    </StackPanel>

                                    <!--  Brand  -->
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="Brand"
                                                   FontSize="{StaticResource FontSize_SM}"
                                                   FontWeight="SemiBold"
                                                   Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                                   Margin="0,0,0,8"/>
                                        <ComboBox x:Name="BrandComboBox"
                                                  HorizontalAlignment="Stretch"
                                                  Height="40"
                                                  CornerRadius="8"
                                                  BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                                  ItemsSource="{x:Bind ViewModel.Brands, Mode=OneWay}"
                                                  SelectedItem="{x:Bind ViewModel.SelectedBrand, Mode=TwoWay}"
                                                  SelectionChanged="BrandComboBox_SelectionChanged"/>
                                    </StackPanel>

                                    <!--  Sort  -->
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Sort By"
                                                   FontSize="{StaticResource FontSize_SM}"
                                                   FontWeight="SemiBold"
                                                   Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                                   Margin="0,0,0,8"/>
                                        <ComboBox x:Name="SortComboBox"
                                                  HorizontalAlignment="Stretch"
                                                  Height="40"
                                                  CornerRadius="8"
                                                  BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                                  SelectedIndex="0"
                                                  SelectionChanged="SortComboBox_SelectionChanged">
                                            <ComboBoxItem Content="Newest"
                                                          Tag="Newest"/>
                                            <ComboBoxItem Content="Name: A to Z"
                                                          Tag="Name: A to Z"/>
                                            <ComboBoxItem Content="Name: Z to A"
                                                          Tag="Name: Z to A"/>
                                            <ComboBoxItem Content="Price: Low to High"
                                                          Tag="Price: Low to High"/>
                                            <ComboBoxItem Content="Price: High to Low"
                                                          Tag="Price: High to Low"/>
                                        </ComboBox>
                                    </StackPanel>
                                </Grid>
                            </forms:FilterCard.FilterContent>
                        </forms:FilterCard>

                        <!--  Loading Skeleton  -->
                        <skeletons:ProductGridSkeleton
                            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>

                        <!--  Empty State - No Products Found  -->
                        <Border
                            Padding="80,60"
                            Style="{StaticResource CardStyle}"
                            Visibility="Collapsed">
                            <StackPanel HorizontalAlignment="Center"
                                        Spacing="20">
                                <Viewbox Width="120"
                                         Height="120">
                                    <Grid>
                                        <Ellipse Width="120"
                                                 Height="120"
                                                 Fill="{ThemeResource Gray100Brush}"/>
                                        <FontIcon
                                            FontSize="{StaticResource FontSize_5XL}"
                                            Foreground="{ThemeResource Gray500Brush}"
                                            Glyph="&#xE721;"/>
                                    </Grid>
                                </Viewbox>
                                <TextBlock
                                    FontSize="{StaticResource FontSize_2XL}"
                                    FontWeight="SemiBold"
                                    Foreground="{ThemeResource TextTertiaryBrush}"
                                    Text="No products found"
                                    TextAlignment="Center"/>
                                <TextBlock
                                    FontSize="{StaticResource FontSize_Base}"
                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    Text="Try adjusting your filters or search query"
                                    TextAlignment="Center"
                                    MaxWidth="300"
                                    TextWrapping="Wrap"/>
                                <Button
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Margin="0,12,0,0"
                                    ToolTipService.ToolTip="Clear all filters">
                                    <StackPanel Orientation="Horizontal"
                                                Spacing="8">
                                        <FontIcon FontSize="{StaticResource FontSize_LG}"
                                                  Glyph="&#xE894;"
                                                  Foreground="{ThemeResource Gray600Brush}"/>
                                        <TextBlock Text="Clear Filters"
                                                   Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </Border>

                        <!--  Products Grid with ProductCard Component  -->
                        <GridView
                            x:Name="ProductGridView"
                            IsItemClickEnabled="False"
                            ItemsSource="{x:Bind ViewModel.Products, Mode=OneWay}"
                            SelectionMode="None"
                            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                            SizeChanged="ProductGridView_SizeChanged">
                            <GridView.ItemContainerTransitions>
                                <TransitionCollection>
                                    <EntranceThemeTransition/>
                                    <RepositionThemeTransition/>
                                    <AddDeleteThemeTransition/>
                                </TransitionCollection>
                            </GridView.ItemContainerTransitions>
                            <GridView.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <ItemsWrapGrid
                                        x:Name="ProductWrapGrid"
                                        ItemWidth="260"
                                        Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </GridView.ItemsPanel>

                            <!--  Product Card Component Template  -->
                            <GridView.ItemTemplate>
                                <DataTemplate x:DataType="vm:ProductCardViewModel">
                                    <cards:ProductCard
                                        Product="{x:Bind Mode=OneWay}"
                                        AddToCartCommand="{Binding ElementName=ProductGridView, Path=DataContext.AddToCartCommand}"
                                        ViewDetailsCommand="{Binding ElementName=ProductGridView, Path=DataContext.ViewProductDetailsCommand}"
                                        VerifyEmailCommand="{Binding ElementName=ProductGridView, Path=DataContext.VerifyEmailCommand}"
                                        CanAddToCart="{x:Bind CanAddToCart, Mode=OneWay}"
                                        ShowEmailVerification="{x:Bind ShowEmailVerification, Mode=OneWay}"/>
                                </DataTemplate>
                            </GridView.ItemTemplate>
                            <GridView.ItemContainerStyle>
                                <Style TargetType="GridViewItem">
                                    <Setter Property="Margin"
                                            Value="8"/>
                                    <Setter Property="HorizontalContentAlignment"
                                            Value="Stretch"/>
                                    <Setter Property="VerticalContentAlignment"
                                            Value="Stretch"/>
                                </Style>
                            </GridView.ItemContainerStyle>
                        </GridView>

                        <!--  Pagination Control (Standardized - Same as AdminUsersPage)  -->
                        <controls:PaginationControl
                            x:Name="PaginationControlElement"
                            Visibility="{x:Bind ViewModel.ShowPagination, Mode=OneWay}"
                            CurrentPage="{x:Bind ViewModel.CurrentPage, Mode=TwoWay}"
                            TotalPages="{x:Bind ViewModel.TotalPages, Mode=OneWay}"
                            TotalItems="{x:Bind ViewModel.TotalItems, Mode=OneWay}"
                            PageSize="{x:Bind ViewModel.PageSize, Mode=TwoWay}"
                            PageChanged="OnPageChanged"
                            PageSizeChanged="OnPageSizeChanged"/>

                    </StackPanel>
                </Grid>
            </ScrollViewer>
        </RefreshContainer>

        <!--  VIEW PRODUCT DETAILS DIALOG  -->
        <ContentDialog
            x:Name="ViewProductDialog"
            Title="Product Details"
            CloseButtonText="Close"
            DefaultButton="Close">
            <ScrollViewer MaxHeight="500"
                          VerticalScrollBarVisibility="Auto">
                <StackPanel Spacing="16"
                            MinWidth="450"
                            Padding="{StaticResource Spacing_2_Thickness}">
                    <!--  Product Image  -->
                    <Border
                        HorizontalAlignment="Center"
                        Width="200"
                        Height="200"
                        Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                        CornerRadius="8"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1">
                        <Grid>
                            <Image
                                x:Name="ViewProductImage"
                                Stretch="UniformToFill"/>
                            <FontIcon
                                x:Name="ViewProductImagePlaceholder"
                                FontSize="{StaticResource FontSize_5XL}"
                                Foreground="{ThemeResource Gray500Brush}"
                                Glyph="&#xE8B9;"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"/>
                        </Grid>
                    </Border>

                    <!--  Product Name + SalesAgent Row  -->
                    <Grid ColumnSpacing="24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0"
                                    Spacing="4">
                            <TextBlock
                                FontSize="{StaticResource FontSize_SM}"
                                FontWeight="SemiBold"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                Text="PRODUCT NAME"/>
                            <TextBlock
                                x:Name="ViewProductName"
                                FontSize="{StaticResource FontSize_XL}"
                                FontWeight="Bold"
                                Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                TextWrapping="Wrap"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1"
                                    Spacing="4">
                            <TextBlock
                                FontSize="{StaticResource FontSize_SM}"
                                FontWeight="SemiBold"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                Text="SALESAGENT"/>
                            <TextBlock
                                x:Name="ViewProductSalesAgent"
                                FontSize="{StaticResource FontSize_Base}"
                                Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                        </StackPanel>
                    </Grid>

                    <!--  Category + Manufacturer Row  -->
                    <Grid ColumnSpacing="24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0"
                                    Spacing="4">
                            <TextBlock
                                FontSize="{StaticResource FontSize_SM}"
                                FontWeight="SemiBold"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                Text="CATEGORY"/>
                            <Border
                                Padding="8,4"
                                Background="{ThemeResource PurpleLightBrush}"
                                CornerRadius="4"
                                HorizontalAlignment="Left">
                                <TextBlock
                                    x:Name="ViewProductCategory"
                                    FontSize="{StaticResource FontSize_SM}"
                                    FontWeight="SemiBold"
                                    Foreground="{ThemeResource PurpleDarkBrush}"/>
                            </Border>
                        </StackPanel>

                        <StackPanel Grid.Column="1"
                                    Spacing="4">
                            <TextBlock
                                FontSize="{StaticResource FontSize_SM}"
                                FontWeight="SemiBold"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                Text="MANUFACTURER"/>
                            <TextBlock
                                x:Name="ViewProductManufacturer"
                                FontSize="{StaticResource FontSize_Base}"
                                Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                        </StackPanel>
                    </Grid>

                    <!--  Description (Span 2 columns)  -->
                    <StackPanel Spacing="4">
                        <TextBlock
                            FontSize="{StaticResource FontSize_SM}"
                            FontWeight="SemiBold"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="DESCRIPTION"/>
                        <TextBlock
                            x:Name="ViewProductDescription"
                            FontSize="{StaticResource FontSize_Base}"
                            Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                            TextWrapping="Wrap"
                            LineHeight="20"/>
                    </StackPanel>

                    <!--  Price Section  -->
                    <Border
                        Background="{ThemeResource SuccessGreen50Brush}"
                        CornerRadius="8"
                        Padding="{StaticResource Padding_LG}">
                        <StackPanel Spacing="4"
                                    HorizontalAlignment="Center">
                            <TextBlock
                                FontSize="{StaticResource FontSize_SM}"
                                FontWeight="SemiBold"
                                Foreground="{ThemeResource SuccessGreenDarkBrush}"
                                Text="PRICE"
                                HorizontalAlignment="Center"/>
                            <TextBlock
                                x:Name="ViewProductPrice"
                                FontSize="{StaticResource FontSize_4XL}"
                                FontWeight="Bold"
                                Foreground="{ThemeResource SuccessGreenDarkBrush}"
                                HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!--  Stock Row  -->
                    <StackPanel Spacing="4">
                        <TextBlock
                            FontSize="{StaticResource FontSize_SM}"
                            FontWeight="SemiBold"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="STOCK"/>
                        <StackPanel Orientation="Horizontal"
                                    Spacing="8">
                            <TextBlock
                                x:Name="ViewProductStock"
                                FontSize="{StaticResource FontSize_3XL}"
                                FontWeight="Bold"
                                Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                            <Border
                                x:Name="ViewProductStockBadge"
                                Padding="8,4"
                                CornerRadius="4"
                                VerticalAlignment="Center">
                                <TextBlock
                                    x:Name="ViewProductStockStatus"
                                    FontSize="{StaticResource FontSize_SM}"
                                    FontWeight="SemiBold"/>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </ContentDialog>

        <!-- Loading Overlay -->
        <components:LoadingOverlay
            IsLoading="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
            Message="Loading products..."/>
    </Grid>
</Page>
