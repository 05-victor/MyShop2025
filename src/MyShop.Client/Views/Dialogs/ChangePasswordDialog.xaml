<?xml version="1.0" encoding="utf-8" ?>
<ContentDialog
    x:Class="MyShop.Client.Views.Dialogs.ChangePasswordDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:MyShop.Client.Views.Controls"
    xmlns:converters="using:MyShop.Client.Common.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:MyShop.Client.Views.Dialogs"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Style="{StaticResource StandardDialogStyle}"
    Title="Change Password"
    PrimaryButtonText="Change Password"
    CloseButtonText="Cancel"
    PrimaryButtonStyle="{StaticResource PrimaryButtonStyle}"
    CloseButtonStyle="{StaticResource SecondaryButtonStyle}"
    DefaultButton="Primary"
    IsPrimaryButtonEnabled="{x:Bind ViewModel.CanSubmit, Mode=OneWay}"
    PrimaryButtonClick="ContentDialog_PrimaryButtonClick"
    mc:Ignorable="d">

    <ContentDialog.Resources>
        <converters:EmptyStringToVisibilityConverter x:Key="StringToVisibilityConverter" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:PasswordStrengthToColorConverter x:Key="PasswordStrengthToColorConverter" />
    </ContentDialog.Resources>

    <Grid Width="400">
        <StackPanel Spacing="{StaticResource Gap_MD}">
            <!--  Instructions  -->
            <TextBlock
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                Text="Enter your current password and choose a new one."
                TextWrapping="Wrap" />

            <!--  Error Message  -->
            <InfoBar
                IsClosable="True"
                IsOpen="{x:Bind ViewModel.HasError, Mode=OneWay}"
                Message="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                Severity="Error" />

            <!--  Loading Indicator  -->
            <ProgressBar
                IsIndeterminate="True"
                Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />

            <!--  Current Password  -->
            <StackPanel Spacing="{StaticResource Gap_XS}">
                <TextBlock Style="{StaticResource InputLabelStyle}">
                    <Run Text="Current Password" />
                    <Run Foreground="{ThemeResource SystemErrorTextColor}" Text="*" />
                </TextBlock>
                <controls:PasswordInputControl Password="{x:Bind ViewModel.CurrentPassword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                <TextBlock
                    Style="{StaticResource ValidationErrorStyle}"
                    Text="{x:Bind ViewModel.CurrentPasswordError, Mode=OneWay}"
                    Visibility="{x:Bind ViewModel.CurrentPasswordError, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}" />
            </StackPanel>

            <!--  New Password  -->
            <StackPanel Spacing="{StaticResource Gap_XS}">
                <TextBlock Style="{StaticResource InputLabelStyle}">
                    <Run Text="New Password" />
                    <Run Foreground="{ThemeResource SystemErrorTextColor}" Text="*" />
                </TextBlock>
                <controls:PasswordInputControl Password="{x:Bind ViewModel.NewPassword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                
                <!-- Password Strength Indicator -->
                <Grid Visibility="{x:Bind ViewModel.NewPassword, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" 
                              Text="Strength: " 
                              FontSize="11" 
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                              Margin="0,2,4,0"/>
                    <TextBlock Grid.Column="1" 
                              Text="{x:Bind ViewModel.PasswordStrength, Mode=OneWay}"
                              FontSize="11"
                              FontWeight="SemiBold"
                              Margin="0,2,0,0">
                        <TextBlock.Foreground>
                            <SolidColorBrush Color="{x:Bind ViewModel.PasswordStrength, Mode=OneWay, Converter={StaticResource PasswordStrengthToColorConverter}}" />
                        </TextBlock.Foreground>
                    </TextBlock>
                </Grid>
                
                <TextBlock
                    Style="{StaticResource ValidationErrorStyle}"
                    Text="{x:Bind ViewModel.NewPasswordError, Mode=OneWay}"
                    Visibility="{x:Bind ViewModel.NewPasswordError, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}" />
            </StackPanel>

            <!--  Confirm New Password  -->
            <StackPanel Spacing="{StaticResource Gap_XS}">
                <TextBlock Style="{StaticResource InputLabelStyle}">
                    <Run Text="Confirm New Password" />
                    <Run Foreground="{ThemeResource SystemErrorTextColor}" Text="*" />
                </TextBlock>
                <controls:PasswordInputControl Password="{x:Bind ViewModel.ConfirmPassword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                <TextBlock
                    Style="{StaticResource ValidationErrorStyle}"
                    Text="{x:Bind ViewModel.ConfirmPasswordError, Mode=OneWay}"
                    Visibility="{x:Bind ViewModel.ConfirmPasswordError, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}" />
            </StackPanel>

            <!--  Password Requirements  -->
            <Border
                Padding="12"
                Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="4">
                <StackPanel Spacing="4">
                    <TextBlock
                        FontSize="12"
                        FontWeight="SemiBold"
                        Text="Password Requirements:" />
                    <TextBlock
                        FontSize="11"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Text="• At least 6 characters" />
                    <TextBlock
                        FontSize="11"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Text="• Must differ from current password" />
                </StackPanel>
            </Border>
        </StackPanel>
    </Grid>
</ContentDialog>
