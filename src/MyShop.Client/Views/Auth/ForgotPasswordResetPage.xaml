<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="MyShop.Client.Views.Auth.ForgotPasswordResetPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:MyShop.Client.Views.Controls"
    xmlns:converters="using:MyShop.Client.Common.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:layout="using:MyShop.Client.Views.Components.Layout"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Background="{ThemeResource LayerFillColorDefaultBrush}"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Page.Resources>

    <Page.Transitions>
        <TransitionCollection>
            <EntranceThemeTransition FromVerticalOffset="50"/>
        </TransitionCollection>
    </Page.Transitions>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <layout:PageHeader
            Grid.Row="0"
            Margin="40,24,40,24"
            Title="Create new password"
            Subtitle="Choose a strong password you haven't used before."/>

        <!-- Content -->
        <ScrollViewer Grid.Row="1"
                      HorizontalScrollBarVisibility="Disabled"
                      VerticalScrollBarVisibility="Auto">
            <Grid MaxWidth="480"
                  Margin="40,0,40,40"
                  HorizontalAlignment="Center">
                
                <!-- Card -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="32">
                    <StackPanel Spacing="24">
                        
                        <!-- New Password -->
                        <StackPanel Spacing="8">
                            <TextBlock Style="{StaticResource InputLabelStyle}">
                                <Run Text="New password"/>
                                <Run Foreground="{ThemeResource SystemErrorTextColor}" Text="*"/>
                            </TextBlock>
                            <controls:PasswordInputControl 
                                Password="{x:Bind ViewModel.NewPassword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="At least 8 characters, include a number and a symbol"
                                       FontSize="{StaticResource FontSize_SM}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>

                        <!-- Confirm Password -->
                        <StackPanel Spacing="8">
                            <TextBlock Style="{StaticResource InputLabelStyle}">
                                <Run Text="Confirm password"/>
                                <Run Foreground="{ThemeResource SystemErrorTextColor}" Text="*"/>
                            </TextBlock>
                            <controls:PasswordInputControl 
                                Password="{x:Bind ViewModel.ConfirmPassword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <!-- Password Strength Checklist -->
                        <Border Background="{ThemeResource LayerFillColorDefaultBrush}"
                                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="6"
                                Padding="16"
                                Visibility="{x:Bind ViewModel.ShowChecklist, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel Spacing="8">
                                <TextBlock Text="Password requirements:"
                                           FontSize="{StaticResource FontSize_SM}"
                                           FontWeight="SemiBold"/>
                                
                                <!-- Minimum Length -->
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="{x:Bind ViewModel.MinLengthIcon, Mode=OneWay}"
                                              FontSize="12"
                                              Foreground="{x:Bind ViewModel.MinLengthColor, Mode=OneWay}"/>
                                    <TextBlock Text="Minimum 8 characters"
                                               FontSize="{StaticResource FontSize_SM}"/>
                                </StackPanel>

                                <!-- Contains Number -->
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="{x:Bind ViewModel.HasNumberIcon, Mode=OneWay}"
                                              FontSize="12"
                                              Foreground="{x:Bind ViewModel.HasNumberColor, Mode=OneWay}"/>
                                    <TextBlock Text="Contains number"
                                               FontSize="{StaticResource FontSize_SM}"/>
                                </StackPanel>

                                <!-- Contains Symbol -->
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="{x:Bind ViewModel.HasSymbolIcon, Mode=OneWay}"
                                              FontSize="12"
                                              Foreground="{x:Bind ViewModel.HasSymbolColor, Mode=OneWay}"/>
                                    <TextBlock Text="Contains symbol"
                                               FontSize="{StaticResource FontSize_SM}"/>
                                </StackPanel>

                                <!-- Passwords Match -->
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="{x:Bind ViewModel.PasswordsMatchIcon, Mode=OneWay}"
                                              FontSize="12"
                                              Foreground="{x:Bind ViewModel.PasswordsMatchColor, Mode=OneWay}"/>
                                    <TextBlock Text="Passwords match"
                                               FontSize="{StaticResource FontSize_SM}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Error Message -->
                        <TextBlock Text="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                                   Visibility="{x:Bind ViewModel.HasError, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                   Style="{StaticResource ValidationErrorStyle}"/>

                        <!-- Loading Indicator -->
                        <ProgressBar IsIndeterminate="True"
                                     Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>

                        <!-- Actions -->
                        <StackPanel Spacing="12">
                            <!-- Reset Password Button -->
                            <Button Style="{StaticResource PrimaryButtonStyle}"
                                    Content="Reset password"
                                    HorizontalAlignment="Stretch"
                                    Command="{x:Bind ViewModel.ResetPasswordCommand}"
                                    IsEnabled="{x:Bind ViewModel.CanResetPassword, Mode=OneWay}"/>
                            
                            <!-- Cancel Button -->
                            <Button Style="{StaticResource SecondaryButtonStyle}"
                                    Content="Cancel"
                                    HorizontalAlignment="Stretch"
                                    Command="{x:Bind ViewModel.CancelCommand}"/>
                        </StackPanel>

                    </StackPanel>
                </Border>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
