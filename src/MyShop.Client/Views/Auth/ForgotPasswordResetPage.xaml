<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="MyShop.Client.Views.Auth.ForgotPasswordResetPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:MyShop.Client.Views.Controls"
    xmlns:converters="using:MyShop.Client.Common.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:forms="using:MyShop.Client.Views.Components.Forms"
    xmlns:layout="using:MyShop.Client.Views.Components.Layout"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Background="{ThemeResource LayerFillColorDefaultBrush}"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:EmptyStringToVisibilityConverter x:Key="EmptyStringToVisibilityConverter"/>
    </Page.Resources>

    <Page.Transitions>
        <TransitionCollection>
            <EntranceThemeTransition FromVerticalOffset="50"/>
        </TransitionCollection>
    </Page.Transitions>

    <!-- Use AuthLayout for consistent 2-column design -->
    <layout:AuthLayout>
        <layout:AuthLayout.FormContent>
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel MaxWidth="420"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="{StaticResource Gap_SM}"
                            Padding="{StaticResource Padding_3XL}">

                    <!-- Header Section -->
                    <StackPanel Spacing="{StaticResource Gap_XS}"
                                Margin="0,0,0,16">
                        <TextBlock Text="MyShop2025"
                                   FontSize="{StaticResource FontSize_5XL}"
                                   FontWeight="Bold"
                                   HorizontalAlignment="Center"
                                   Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                   AutomationProperties.HeadingLevel="Level1"/>
                        <TextBlock Text="Create New Password"
                                   FontSize="{StaticResource FontSize_3XL}"
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center"
                                   Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                   AutomationProperties.HeadingLevel="Level2"/>
                        <TextBlock Text="Choose a strong password you haven't used before"
                                   FontSize="{StaticResource FontSize_Base}"
                                   HorizontalAlignment="Center"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   TextWrapping="Wrap"/>
                    </StackPanel>

                    <!-- Email Display -->
                    <StackPanel Spacing="{StaticResource Gap_XS}">
                        <TextBlock Style="{StaticResource InputLabelStyle}">
                            <Run Text="Email"/>
                        </TextBlock>
                        <TextBlock Text="{x:Bind ViewModel.Email, Mode=OneWay}"
                                   FontSize="{StaticResource FontSize_Base}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   Margin="0,0,0,12"/>
                    </StackPanel>

                    <!-- Verification Code using FormField -->
                    <forms:FormField Label="Verification Code"
                                     IsRequired="True"
                                     HelpText="Check your email for the verification code"
                                     ErrorMessage="">
                        <forms:FormField.InputContent>
                            <TextBox PlaceholderText="Enter code from email"
                                     Text="{x:Bind ViewModel.ResetCode, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     MaxLength="10"
                                     InputScope="Text"
                                     Style="{StaticResource BaseInputStyle}"/>
                        </forms:FormField.InputContent>
                    </forms:FormField>

                    <!-- New Password using FormField -->
                    <forms:FormField Label="New Password"
                                     IsRequired="True"
                                     HelpText="Minimum 6 characters"
                                     ErrorMessage="">
                        <forms:FormField.InputContent>
                            <controls:PasswordInputControl
                                Password="{x:Bind ViewModel.NewPassword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </forms:FormField.InputContent>
                    </forms:FormField>

                    <!-- Confirm Password using FormField -->
                    <forms:FormField Label="Confirm Password"
                                     IsRequired="True"
                                     HelpText=""
                                     ErrorMessage="">
                        <forms:FormField.InputContent>
                            <controls:PasswordInputControl
                                Password="{x:Bind ViewModel.ConfirmPassword, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </forms:FormField.InputContent>
                    </forms:FormField>

                    <!-- Password Strength Checklist -->
                    <Border Background="{ThemeResource LayerFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="{StaticResource BorderThickness_Thin}"
                            CornerRadius="{StaticResource Radius_MD}"
                            Padding="12"
                            Visibility="{x:Bind ViewModel.ShowChecklist, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                            Margin="0,12,0,0">
                        <StackPanel Spacing="{StaticResource Gap_XS}">
                            <TextBlock Text="Password requirements:"
                                       FontSize="{StaticResource FontSize_SM}"
                                       FontWeight="SemiBold"/>

                            <!-- Minimum Length -->
                            <StackPanel Orientation="Horizontal"
                                        Spacing="{StaticResource Gap_XS}">
                                <FontIcon Glyph="{x:Bind ViewModel.MinLengthIcon, Mode=OneWay}"
                                          FontSize="{StaticResource FontSize_SM}"
                                          Foreground="{x:Bind ViewModel.MinLengthColor, Mode=OneWay}"/>
                                <TextBlock Text="Minimum 6 characters"
                                           FontSize="{StaticResource FontSize_SM}"/>
                            </StackPanel>

                            <!-- Passwords Match -->
                            <StackPanel Orientation="Horizontal"
                                        Spacing="{StaticResource Gap_XS}">
                                <FontIcon Glyph="{x:Bind ViewModel.PasswordsMatchIcon, Mode=OneWay}"
                                          FontSize="{StaticResource FontSize_SM}"
                                          Foreground="{x:Bind ViewModel.PasswordsMatchColor, Mode=OneWay}"/>
                                <TextBlock Text="Passwords match"
                                           FontSize="{StaticResource FontSize_SM}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Error Message -->
                    <TextBlock Text="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                               Visibility="{x:Bind ViewModel.HasError, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                               Style="{StaticResource ValidationErrorStyle}"/>

                    <!-- Loading Indicator -->
                    <ProgressBar IsIndeterminate="True"
                                 Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                 Margin="0,12,0,0"/>

                    <!-- Action Buttons -->
                    <StackPanel Spacing="{StaticResource Gap_SM}">
                        <!-- Reset Password Button -->
                        <Button Style="{StaticResource PrimaryButtonStyle}"
                                Content="Reset Password"
                                HorizontalAlignment="Stretch"
                                Command="{x:Bind ViewModel.ResetPasswordCommand}"
                                IsEnabled="{x:Bind ViewModel.CanResetPassword, Mode=OneWay}"/>

                        <!-- Cancel Button -->
                        <Button Style="{StaticResource SecondaryButtonStyle}"
                                Content="Cancel"
                                HorizontalAlignment="Stretch"
                                Command="{x:Bind ViewModel.CancelCommand}"/>
                    </StackPanel>

                </StackPanel>
            </ScrollViewer>
        </layout:AuthLayout.FormContent>
    </layout:AuthLayout>
</Page>
