<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="MyShop.Client.Views.Auth.ForgotPasswordOtpPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:MyShop.Client.Common.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:layout="using:MyShop.Client.Views.Components.Layout"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Background="{ThemeResource LayerFillColorDefaultBrush}"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
    </Page.Resources>

    <Page.Transitions>
        <TransitionCollection>
            <EntranceThemeTransition FromVerticalOffset="50"/>
        </TransitionCollection>
    </Page.Transitions>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="40,24,40,24" Spacing="8">
            <TextBlock Text="Verify code" 
                       Style="{StaticResource DisplayHeadingStyle}"
                       Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                       AutomationProperties.HeadingLevel="Level1"/>
            <StackPanel Orientation="Horizontal" Spacing="4">
                <TextBlock Text="We sent a 6-digit code to" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <TextBlock Text="{x:Bind ViewModel.MaskedEmail, Mode=OneWay}" FontWeight="SemiBold"/>
            </StackPanel>
        </StackPanel>

        <!-- Content -->
        <ScrollViewer Grid.Row="1"
                      HorizontalScrollBarVisibility="Disabled"
                      VerticalScrollBarVisibility="Auto">
            <Grid MaxWidth="480"
                  Margin="40,0,40,40"
                  HorizontalAlignment="Center">
                
                <!-- Card -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="32">
                    <StackPanel Spacing="24">
                        
                        <!-- OTP Input -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Verification Code"
                                       Style="{StaticResource InputLabelStyle}"/>
                            <TextBox x:Name="OtpTextBox"
                                     Style="{StaticResource BaseInputStyle}"
                                     PlaceholderText="Enter 6-digit code"
                                     InputScope="Number"
                                     MaxLength="6"
                                     HorizontalAlignment="Stretch"
                                     FontFamily="Consolas"
                                     FontSize="20"
                                     TextAlignment="Center"
                                     CharacterSpacing="200"
                                     Text="{x:Bind ViewModel.OtpCode, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            
                            <!-- Timer and Resend -->
                            <Grid>
                                <TextBlock Text="{x:Bind ViewModel.TimerText, Mode=OneWay}"
                                           FontSize="{StaticResource FontSize_SM}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           HorizontalAlignment="Left"/>
                                <HyperlinkButton Content="Resend code"
                                                 FontSize="{StaticResource FontSize_SM}"
                                                 HorizontalAlignment="Right"
                                                 Command="{x:Bind ViewModel.ResendCodeCommand}"
                                                 IsEnabled="{x:Bind ViewModel.CanResend, Mode=OneWay}"/>
                            </Grid>

                            <!-- Change Email Link -->
                            <HyperlinkButton Content="Change email"
                                             FontSize="{StaticResource FontSize_SM}"
                                             Command="{x:Bind ViewModel.ChangeEmailCommand}"/>
                            
                            <!-- Error Message -->
                            <TextBlock Text="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                                       Visibility="{x:Bind ViewModel.HasError, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                       Style="{StaticResource ValidationErrorStyle}"/>
                        </StackPanel>

                        <!-- Loading Indicator -->
                        <ProgressBar IsIndeterminate="True"
                                     Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>

                        <!-- Actions -->
                        <StackPanel Spacing="12">
                            <!-- Verify Button -->
                            <Button Style="{StaticResource PrimaryButtonStyle}"
                                    Content="Verify"
                                    HorizontalAlignment="Stretch"
                                    Command="{x:Bind ViewModel.VerifyCommand}"
                                    IsEnabled="{x:Bind ViewModel.CanVerify, Mode=OneWay}"/>
                            
                            <!-- Back Button -->
                            <Button Style="{StaticResource SecondaryButtonStyle}"
                                    Content="Back"
                                    HorizontalAlignment="Stretch"
                                    Command="{x:Bind ViewModel.BackCommand}"/>
                        </StackPanel>

                    </StackPanel>
                </Border>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
