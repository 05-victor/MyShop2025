<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MyShop.Client.Views.SalesAgent.SalesAgentDashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:buttons="using:MyShop.Client.Views.Components.Buttons"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:MyShop.Client.ViewModels.SalesAgent"
    xmlns:cards="using:MyShop.Client.Views.Components.Cards"
    xmlns:charts="using:MyShop.Client.Views.Components.Charts"
    xmlns:layout="using:MyShop.Client.Views.Components.Layout"
    xmlns:converters="using:MyShop.Client.Common.Converters"
    mc:Ignorable="d"
    Background="{ThemeResource PageBackgroundBrush}"
    x:Name="MyPage">

    <Page.Transitions>
        <TransitionCollection>
            <EntranceThemeTransition FromVerticalOffset="50"/>
        </TransitionCollection>
    </Page.Transitions>

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter"/>
        <converters:CountToVisibilityConverter x:Key="InverseCountToVisibilityConverter"
                                               IsInverted="True"/>
        <converters:CurrencyConverter x:Key="CurrencyConverter"/>
    </Page.Resources>

    <Grid>
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="ResponsiveStates">

                <!-- Large Desktop: 1920px+ -->
                <VisualState x:Name="LargeDesktopState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1920"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="MainContent.Padding"
                                Value="40"/>
                        <Setter Target="KPIGrid.ColumnSpacing"
                                Value="24"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- Desktop: 1280-1919px -->
                <VisualState x:Name="DesktopState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1280"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="MainContent.Padding"
                                Value="32"/>
                        <Setter Target="KPIGrid.ColumnSpacing"
                                Value="20"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- Tablet: 960-1279px -->
                <VisualState x:Name="TabletState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="960"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="MainContent.Padding"
                                Value="24"/>
                        <Setter Target="KPIGrid.ColumnSpacing"
                                Value="16"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- Tablet Portrait: 640-959px -->
                <VisualState x:Name="TabletPortraitState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="640"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="MainContent.Padding"
                                Value="20"/>
                        <Setter Target="KPIGrid.ColumnSpacing"
                                Value="12"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- Mobile: 0-639px (Default) -->
                <VisualState x:Name="MobileState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="MainContent.Padding"
                                Value="16"/>
                        <Setter Target="KPIGrid.ColumnSpacing"
                                Value="8"/>
                    </VisualState.Setters>
                </VisualState>

            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <!-- Layer 0: Dashboard Content (Hidden during loading) -->
        <Grid x:Name="DashboardContent"
              Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
            <Grid.Transitions>
                <TransitionCollection>
                    <EntranceThemeTransition FromVerticalOffset="50"/>
                </TransitionCollection>
            </Grid.Transitions>
            <RefreshContainer RefreshRequested="RefreshContainer_RefreshRequested">
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              Background="{ThemeResource PageBackgroundBrush}">
                    <Grid x:Name="MainContent"
                          Padding="24"
                          RowSpacing="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Page Header Section -->
                        <StackPanel Grid.Row="0"
                                    Spacing="16">

                            <!-- Email Verification Warning -->
                            <InfoBar
                                Severity="Warning"
                                Title="Email Verification Required"
                                Message="Please verify your email to start selling products"
                                IsOpen="{x:Bind ViewModel.IsVerified, Mode=OneWay, Converter={StaticResource InverseBoolConverter}}"
                                IsClosable="False">
                                <InfoBar.ActionButton>
                                    <Button
                                        Content="Resend Email"
                                        Style="{StaticResource AccentButtonStyle}"/>
                                </InfoBar.ActionButton>
                            </InfoBar>

                            <!-- Page Header -->
                            <layout:PageHeader
                                Title="Sales Agent Dashboard"
                                Subtitle="Track your sales performance and commissions">
                                <layout:PageHeader.ActionContent>
                                    <StackPanel Orientation="Horizontal"
                                                Spacing="12">
                                        <ComboBox Width="180"
                                                  Height="40"
                                                  CornerRadius="8"
                                                  BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                                  ItemsSource="{x:Bind ViewModel.DateRangeOptions}"
                                                  SelectedIndex="{x:Bind ViewModel.SelectedDateRangeIndex, Mode=TwoWay}"
                                                  AutomationProperties.Name="Select date range"
                                                  AutomationProperties.HelpText="Choose the time period for sales data"
                                                  UseSystemFocusVisuals="True"/>

                                        <buttons:IconButton
                                            Variant="Filled"
                                            IconGlyph="&#xE896;"
                                            Text="Export"
                                            Command="{x:Bind ViewModel.ExportCommand}"/>
                                    </StackPanel>
                                </layout:PageHeader.ActionContent>
                            </layout:PageHeader>

                        </StackPanel>

                        <!-- Main Content -->
                        <StackPanel Grid.Row="1"
                                    Spacing="20">

                            <!-- KPI Cards -->
                            <Grid x:Name="KPIGrid"
                                  ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Total Products KPI -->
                                <cards:KPICard
                                    Grid.Column="0"
                                    Title="Total Products"
                                    Icon="&#xE7B8;"
                                    Value="{x:Bind ViewModel.TotalProducts, Mode=OneWay}"
                                    Subtitle="Products listed"
                                    ShowBadge="Collapsed"/>

                                <!-- Total Sales KPI -->
                                <cards:KPICard
                                    Grid.Column="1"
                                    Title="Total Sales"
                                    Icon="&#xE7BF;"
                                    Value="{x:Bind ViewModel.TotalSales, Mode=OneWay}"
                                    Subtitle="Orders completed"
                                    ShowBadge="Collapsed"
                                    IconBackgroundBrush="{ThemeResource InfoBlueLightBrush}"
                                    IconForegroundBrush="{ThemeResource PrimaryBrush}"
                                    BadgeBackgroundBrush="{ThemeResource InfoBlueLightBrush}"
                                    BadgeForegroundBrush="{ThemeResource PrimaryBrush}"/>

                                <!-- Commission KPI -->
                                <cards:KPICard
                                    Grid.Column="2"
                                    Title="Commission Earned"
                                    Icon="&#xE7DB;"
                                    Value="{x:Bind ViewModel.TotalCommission, Mode=OneWay}"
                                    IsCurrency="True"
                                    ShowBadge="Collapsed"
                                    IconBackgroundBrush="{ThemeResource SuccessGreenLightBrush}"
                                    IconForegroundBrush="{ThemeResource SuccessGreenBrush}"
                                    BadgeBackgroundBrush="{ThemeResource SuccessGreenLightBrush}"
                                    BadgeForegroundBrush="{ThemeResource SuccessGreenBrush}"/>

                                <!-- Total Revenue KPI -->
                                <cards:KPICard
                                    Grid.Column="3"
                                    Title="Total Revenue"
                                    Icon="&#xE8EC;"
                                    Value="{x:Bind ViewModel.TotalRevenue, Mode=OneWay}"
                                    Subtitle="Sales generated"
                                    IsCurrency="True"
                                    ShowBadge="Collapsed"
                                    IconBackgroundBrush="{ThemeResource PurpleLightBrush}"
                                    IconForegroundBrush="{ThemeResource PurpleBrush}"
                                    BadgeBackgroundBrush="{ThemeResource PurpleLightBrush}"
                                    BadgeForegroundBrush="{ThemeResource PurpleBrush}"/>
                            </Grid>

                            <!-- Row 1: Chart + Top Links -->
                            <Grid ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Revenue Trend Chart (Same as Admin - using LineChartCard) -->
                                <charts:LineChartCard Grid.Column="0"
                                                      Title="Revenue &amp; Commission Trend"
                                                      Series="{x:Bind ViewModel.RevenueSeries, Mode=OneWay}"
                                                      ChartHeight="300"
                                                      ShowLegend="Visible"
                                                      ShowLegend2="Visible"
                                                      Legend1Text="Revenue"
                                                      Legend2Text="Commission"
                                                      ShowMenu="Visible"
                                                      RefreshRequested="LineChart_RefreshRequested"
                                                      ExportRequested="LineChart_ExportRequested"/>

                                <!-- Top Selling Products -->
                                <Border Grid.Column="1"
                                        Style="{StaticResource CardWithShadowStyle}">
                                    <StackPanel Spacing="16">
                                        <TextBlock Text="Top Selling Products"
                                                   FontSize="{StaticResource FontSize_XL}"
                                                   FontWeight="SemiBold"
                                                   Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>

                                        <!-- Changed to {Binding} for async loaded API data -->
                                        <ListView ItemsSource="{Binding TopLinks, Mode=OneWay}"
                                                  SelectionMode="None">
                                            <ListView.ItemTemplate>
                                                <DataTemplate x:DataType="viewmodels:TopAffiliateLink">
                                                    <Border Padding="{StaticResource Spacing_3_Thickness}"
                                                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                                            BorderThickness="0,0,0,1">
                                                        <Grid>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                            </Grid.RowDefinitions>

                                                            <TextBlock Grid.Row="0"
                                                                       Text="{x:Bind Product}"
                                                                       FontSize="{StaticResource FontSize_Base}"
                                                                       FontWeight="SemiBold"
                                                                       Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                                                       TextTrimming="CharacterEllipsis"/>

                                                            <Grid Grid.Row="1"
                                                                  Margin="0,4,0,0">
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>

                                                                <!-- Product Image -->
                                                                <Border Grid.Column="0"
                                                                        Width="60"
                                                                        Height="60"
                                                                        Margin="0,0,12,0"
                                                                        CornerRadius="6"
                                                                        Background="{ThemeResource SubtleFillColorSecondaryBrush}">
                                                                    <Image Source="{x:Bind ImageUrl, Converter={StaticResource StringToImageSourceConverter}}"
                                                                           Stretch="UniformToFill"/>
                                                                </Border>

                                                                <!-- Product Details -->
                                                                <StackPanel Grid.Column="1"
                                                                            Spacing="6"
                                                                            VerticalAlignment="Center">
                                                                    <TextBlock Text="{x:Bind Product}"
                                                                               FontSize="{StaticResource FontSize_SM}"
                                                                               FontWeight="SemiBold"
                                                                               Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                                                               TextTrimming="CharacterEllipsis"/>
                                                                    <TextBlock Text="{x:Bind CategoryName}"
                                                                               FontSize="{StaticResource FontSize_XS}"
                                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                                    <TextBlock FontSize="{StaticResource FontSize_XS}"
                                                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                                                    <Run Text="Sold: "/>
                                                                    <Run Text="{x:Bind SoldCount}"
                                                                         Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                                                         FontWeight="SemiBold"/>
                                                                    </TextBlock>
                                                                </StackPanel>

                                                                <!-- Revenue -->
                                                                <TextBlock Grid.Column="2"
                                                                           FontSize="{StaticResource FontSize_Base}"
                                                                           TextAlignment="Right"
                                                                           FontWeight="Bold"
                                                                           Foreground="{ThemeResource SuccessGreenBrush}"
                                                                           VerticalAlignment="Center"
                                                                           Text="{x:Bind Revenue, Converter={StaticResource CurrencyConverter}}"/>
                                                            </Grid>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ListView.ItemTemplate>
                                            <ListView.ItemContainerStyle>
                                                <Style TargetType="ListViewItem">
                                                    <Setter Property="Padding"
                                                            Value="0"/>
                                                    <Setter Property="Margin"
                                                            Value="0"/>
                                                    <Setter Property="HorizontalContentAlignment"
                                                            Value="Stretch"/>
                                                </Style>
                                            </ListView.ItemContainerStyle>
                                        </ListView>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- Row 2: Low Stock Products + Recent Orders -->
                            <Grid ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="2*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Low Stock Products List -->
                                <Border Grid.Column="0"
                                        Style="{StaticResource CardWithShadowStyle}">
                                    <StackPanel Spacing="16">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0"
                                                       Text="Low Stock Products"
                                                       FontSize="{StaticResource FontSize_XL}"
                                                       FontWeight="SemiBold"
                                                       Foreground="{ThemeResource Gray900Brush}"/>

                                            <!-- Badge showing count -->
                                            <Border Grid.Column="1"
                                                    Background="{ThemeResource ErrorRedLightBrush}"
                                                    CornerRadius="8"
                                                    Padding="8,4">
                                                <TextBlock Text="{x:Bind ViewModel.LowStockProducts.Count, Mode=OneWay}"
                                                           FontSize="{StaticResource FontSize_SM}"
                                                           FontWeight="SemiBold"
                                                           Foreground="{ThemeResource ErrorRedBrush}"/>
                                            </Border>
                                        </Grid>

                                        <!-- Low Stock Products List (Visibility based on collection) -->
                                        <ListView x:Name="LowStockProductsListView"
                                                  ItemsSource="{x:Bind ViewModel.LowStockProducts, Mode=OneWay}"
                                                  SelectionMode="None"
                                                  Visibility="{x:Bind ViewModel.LowStockProducts, Mode=OneWay, Converter={StaticResource CountToVisibilityConverter}}">
                                            <ListView.ItemTemplate>
                                                <DataTemplate x:DataType="viewmodels:LowStockProduct">
                                                    <Border Padding="{StaticResource Spacing_3_Thickness}"
                                                            BorderBrush="{ThemeResource Gray300Brush}"
                                                            BorderThickness="0,0,0,1">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                            </Grid.ColumnDefinitions>

                                                            <!-- Product Image -->
                                                            <Border Grid.Column="0"
                                                                    Width="70"
                                                                    Height="70"
                                                                    CornerRadius="6"
                                                                    Margin="0,0,12,0"
                                                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                                                                <Image Source="{x:Bind ImageUrl, Converter={StaticResource StringToImageSourceConverter}}"
                                                                       Stretch="UniformToFill"/>
                                                            </Border>

                                                            <!-- Product Details -->
                                                            <StackPanel Grid.Column="1"
                                                                        Spacing="8">
                                                                <TextBlock Text="{x:Bind Name}"
                                                                           FontSize="{StaticResource FontSize_SM}"
                                                                           FontWeight="SemiBold"
                                                                           Foreground="{ThemeResource Gray900Brush}"
                                                                           TextTrimming="CharacterEllipsis"/>

                                                                <!-- Desktop Layout: Horizontal Category + Quantity -->
                                                                <Grid x:Name="DesktopLayout">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>

                                                                    <TextBlock Grid.Column="0"
                                                                               Text="{x:Bind CategoryName}"
                                                                               FontSize="{StaticResource FontSize_SM}"
                                                                               Foreground="{ThemeResource Gray600Brush}"
                                                                               VerticalAlignment="Center"/>

                                                                    <Border Grid.Column="1"
                                                                            Background="{ThemeResource ErrorRedLightBrush}"
                                                                            CornerRadius="8"
                                                                            Padding="6,2">
                                                                        <TextBlock FontSize="{StaticResource FontSize_XS}"
                                                                                   FontWeight="SemiBold"
                                                                                   Foreground="{ThemeResource ErrorRedBrush}">
                                                            <Run Text="Quantity: "/><Run Text="{x:Bind Quantity}"/>
                                                                        </TextBlock>
                                                                    </Border>
                                                                </Grid>

                                                                <!-- Tablet Layout: Vertical Category + Quantity -->
                                                                <StackPanel x:Name="TabletLayout"
                                                                            Spacing="6"
                                                                            Visibility="Collapsed">
                                                                    <TextBlock Text="{x:Bind CategoryName}"
                                                                               FontSize="{StaticResource FontSize_SM}"
                                                                               Foreground="{ThemeResource Gray600Brush}"/>

                                                                    <Border Background="{ThemeResource ErrorRedLightBrush}"
                                                                            CornerRadius="8"
                                                                            Padding="6,2"
                                                                            HorizontalAlignment="Left">
                                                                        <TextBlock FontSize="{StaticResource FontSize_XS}"
                                                                                   FontWeight="SemiBold"
                                                                                   Foreground="{ThemeResource ErrorRedBrush}">
                                                            <Run Text="Quantity: "/><Run Text="{x:Bind Quantity}"/>
                                                                        </TextBlock>
                                                                    </Border>
                                                                </StackPanel>
                                                            </StackPanel>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ListView.ItemTemplate>
                                            <ListView.ItemContainerStyle>
                                                <Style TargetType="ListViewItem">
                                                    <Setter Property="Padding"
                                                            Value="0"/>
                                                    <Setter Property="Margin"
                                                            Value="0"/>
                                                    <Setter Property="HorizontalContentAlignment"
                                                            Value="Stretch"/>
                                                </Style>
                                            </ListView.ItemContainerStyle>
                                        </ListView>

                                        <!-- Empty State when no low stock products -->
                                        <TextBlock Text="All products have healthy stock levels"
                                                   FontSize="{StaticResource FontSize_SM}"
                                                   Foreground="{ThemeResource Gray500Brush}"
                                                   TextAlignment="Center"
                                                   Visibility="{x:Bind ViewModel.LowStockProducts, Mode=OneWay, Converter={StaticResource InverseCountToVisibilityConverter}}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Recent Orders Table -->
                                <cards:DataTableCard Grid.Column="1"
                                                     Title="Recent Orders"
                                                     ViewAllText="View All Orders"
                                                     ShowViewAll="Visible"
                                                     ViewAllCommand="{x:Bind ViewModel.ViewAllOrdersCommand}">
                                    <cards:DataTableCard.TableContent>
                                        <!-- Changed to {Binding} for async loaded API data -->
                                        <ListView ItemsSource="{Binding RecentOrders, Mode=OneWay}"
                                                  SelectionMode="None"
                                                  MaxHeight="400">
                                            <ListView.Header>
                                                <Grid Padding="{StaticResource Spacing_3_Thickness}"
                                                      BorderBrush="{ThemeResource Gray300Brush}"
                                                      BorderThickness="0,0,0,1">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <TextBlock Grid.Column="0"
                                                               Text="ORDER ID"
                                                               FontSize="{StaticResource FontSize_XS}"
                                                               FontWeight="SemiBold"
                                                               Foreground="{ThemeResource Gray600Brush}"/>
                                                    <TextBlock Grid.Column="1"
                                                               Text="CUSTOMER"
                                                               FontSize="{StaticResource FontSize_XS}"
                                                               FontWeight="SemiBold"
                                                               Foreground="{ThemeResource Gray600Brush}"/>
                                                    <TextBlock Grid.Column="2"
                                                               Text="PRODUCT"
                                                               FontSize="{StaticResource FontSize_XS}"
                                                               FontWeight="SemiBold"
                                                               Foreground="{ThemeResource Gray600Brush}"/>
                                                    <TextBlock Grid.Column="3"
                                                               Text="DATE"
                                                               FontSize="{StaticResource FontSize_XS}"
                                                               FontWeight="SemiBold"
                                                               Foreground="{ThemeResource Gray600Brush}"/>
                                                    <TextBlock Grid.Column="4"
                                                               Text="AMOUNT"
                                                               FontSize="{StaticResource FontSize_XS}"
                                                               FontWeight="SemiBold"
                                                               Foreground="{ThemeResource Gray600Brush}"/>
                                                    <TextBlock Grid.Column="5"
                                                               Text="STATUS"
                                                               FontSize="{StaticResource FontSize_XS}"
                                                               FontWeight="SemiBold"
                                                               Foreground="{ThemeResource Gray600Brush}"/>
                                                </Grid>
                                            </ListView.Header>

                                            <ListView.ItemTemplate>
                                                <DataTemplate x:DataType="viewmodels:RecentSalesOrder">
                                                    <Grid Padding="{StaticResource Spacing_3_Thickness}"
                                                          BorderBrush="{ThemeResource Gray300Brush}"
                                                          BorderThickness="0,0,0,1">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <TextBlock Grid.Column="0"
                                                                   Text="{x:Bind OrderId}"
                                                                   FontSize="{StaticResource FontSize_SM}"
                                                                   FontFamily="Consolas"
                                                                   Foreground="{ThemeResource Gray600Brush}"/>

                                                        <TextBlock Grid.Column="1"
                                                                   Text="{x:Bind Customer}"
                                                                   FontSize="{StaticResource FontSize_Base}"
                                                                   Foreground="{ThemeResource Gray900Brush}"/>

                                                        <TextBlock Grid.Column="2"
                                                                   Text="{x:Bind Product}"
                                                                   FontSize="{StaticResource FontSize_Base}"
                                                                   Foreground="{ThemeResource Gray600Brush}"
                                                                   TextTrimming="CharacterEllipsis"/>

                                                        <TextBlock Grid.Column="3"
                                                                   Text="{x:Bind OrderDate}"
                                                                   FontSize="{StaticResource FontSize_SM}"
                                                                   Foreground="{ThemeResource Gray600Brush}"/>

                                                        <TextBlock Grid.Column="4"
                                                                   FontSize="{StaticResource FontSize_Base}"
                                                                   FontWeight="SemiBold"
                                                                   Foreground="{ThemeResource Gray900Brush}">
                                        <Run Text="{x:Bind Amount, Converter={StaticResource CurrencyConverter}}"/>
                                                        </TextBlock>

                                                        <Border Grid.Column="5"
                                                                Background="{ThemeResource InfoBlueLightBrush}"
                                                                CornerRadius="999"
                                                                Padding="8,4"
                                                                HorizontalAlignment="Left">
                                                            <TextBlock Text="{x:Bind Status}"
                                                                       FontSize="{StaticResource FontSize_SM}"
                                                                       FontWeight="SemiBold"
                                                                       Foreground="{ThemeResource InfoBlueDarkBrush}"/>
                                                        </Border>
                                                    </Grid>
                                                </DataTemplate>
                                            </ListView.ItemTemplate>

                                            <ListView.ItemContainerStyle>
                                                <Style TargetType="ListViewItem">
                                                    <Setter Property="Padding"
                                                            Value="0"/>
                                                    <Setter Property="Margin"
                                                            Value="0"/>
                                                    <Setter Property="HorizontalContentAlignment"
                                                            Value="Stretch"/>
                                                </Style>
                                            </ListView.ItemContainerStyle>
                                        </ListView>
                                    </cards:DataTableCard.TableContent>
                                </cards:DataTableCard>
                            </Grid>

                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </RefreshContainer>
        </Grid>

        <!-- Layer 1: Loading Overlay (Shown during loading) -->
        <Grid x:Name="LoadingOverlay"
              Background="{ThemeResource LayerFillColorDefaultBrush}"
              Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Spacing="24"
                        Padding="{StaticResource Padding_3XL}">
                <ProgressRing IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                              Width="64"
                              Height="64"/>
                <TextBlock Text="Loading dashboard data..."
                           FontSize="{StaticResource FontSize_XL}"
                           FontWeight="SemiBold"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           HorizontalAlignment="Center"/>
                <TextBlock Text="Please wait while we fetch your analytics"
                           FontSize="{StaticResource FontSize_Base}"
                           Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>

